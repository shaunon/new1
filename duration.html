<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Duration Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@sgratzl/chartjs-chart-boxplot/build/index.umd.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            margin: 0;
            padding: 20px 0;
        }
        .main-container {
            width: 1900px;
            margin: auto;
            background-color: #fff;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border-radius: 8px;
        }
        .grid-container {
            display: grid;
            grid-template-columns: 60% 40%;
            gap: 25px;
            margin-bottom: 25px;
        }
        .grid-item-main {
            grid-column: 1 / 2;
        }
        .grid-item-side {
            grid-column: 2 / 3;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        .section {
            padding: 20px;
            background-color: #ffffff;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .grid-item-side .section {
            flex: 1;
            margin: 0;
        }
        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .chart-wrapper {
            height: 380px;
            position: relative;
        }
        .data-table-container {
            margin-top: 20px;
            max-height: 450px;
            overflow-y: auto;
            border-radius: 4px;
            border: 1px solid #eee;
        }
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .table-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 500;
        }
        .download-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .download-btn:hover {
            background-color: #45a049;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        th, td {
            border: 1px solid #dee2e6;
            padding: 12px 15px;
            text-align: left;
            vertical-align: middle;
        }
        thead th {
            background-color: #f2f2f2;
            color: #343a40;
            font-weight: 600;
            position: sticky;
            top: 0;
            cursor: pointer;
            z-index: 1;
        }
        .sortable-header {
            position: relative;
            padding-right: 25px;
        }
        .sort-icon {
            position: absolute;
            right: 8px;
            color: #999;
        }
        .sorted-asc .sort-icon {
            color: #333;
            content: "↑";
        }
        .sorted-desc .sort-icon {
            color: #333;
            content: "↓";
        }
        tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        tbody tr:hover {
            background-color: #e9ecef;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="grid-container">
            <div class="grid-item-main">
                <div class="section">
                    <h2 class="section-title">Video Distribution by Length</h2>
                    <button class="download-btn" style="position: absolute; top: 20px; right: 20px;" onclick="downloadChart('histogramChart')">Download Chart</button>
                    <div class="chart-wrapper">
                        <canvas id="histogramChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="grid-item-side">
                <div class="section">
                    <h2 class="section-title">Engagement by Video Length</h2>
                    <button class="download-btn" style="position: absolute; top: 20px; right: 20px;" onclick="downloadChart('engagementChart')">Download Chart</button>
                    <div class="chart-wrapper">
                        <canvas id="engagementChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="grid-container" style="margin-top: 0;">
            <div class="grid-item-main">
                <div class="section">
                    <h2 class="section-title">Video Length by Category</h2>
                    <button class="download-btn" style="position: absolute; top: 20px; right: 20px;" onclick="downloadChart('boxplotChart')">Download Chart</button>
                    <div class="chart-wrapper">
                        <canvas id="boxplotChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="grid-item-side">
                <!-- 预留空间，保持布局平衡 -->
            </div>
        </div>
        <div class="section">
            <h2 class="section-title">Detailed Data Breakdown</h2>
            <div class="data-table-container">
                <div class="table-header">
                    <button class="download-btn" onclick="downloadTableAsCSV('data-table')">Download Data</button>
                </div>
                <table id="data-table" class="sortable">
                    <thead>
                        <tr>
                            <th class="sortable-header" onclick="sortTable(0)">Video Length Range <span class="sort-icon">↕</span></th>
                            <th class="sortable-header" onclick="sortTable(1)">Number of Videos <span class="sort-icon">↕</span></th>
                            <th class="sortable-header" onclick="sortTable(2)">Percentage of Videos <span class="sort-icon">↕</span></th>
                            <th class="sortable-header" onclick="sortTable(3)">Average Interaction Rate <span class="sort-icon">↕</span></th>
                            <th class="sortable-header" onclick="sortTable(4)">Average Comments Number <span class="sort-icon">↕</span></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>0-15s</td>
                            <td>1,250</td>
                            <td>35.7%</td>
                            <td>8.5%</td>
                            <td>15</td>
                        </tr>
                        <tr>
                            <td>16-30s</td>
                            <td>980</td>
                            <td>28.0%</td>
                            <td>9.2%</td>
                            <td>28</td>
                        </tr>
                        <tr>
                            <td>31-60s</td>
                            <td>720</td>
                            <td>20.6%</td>
                            <td>10.1%</td>
                            <td>45</td>
                        </tr>
                        <tr>
                            <td>1-3min</td>
                            <td>350</td>
                            <td>10.0%</td>
                            <td>12.5%</td>
                            <td>88</td>
                        </tr>
                        <tr>
                            <td>3-5min</td>
                            <td>110</td>
                            <td>3.1%</td>
                            <td>11.8%</td>
                            <td>110</td>
                        </tr>
                        <tr>
                            <td>5-10min</td>
                            <td>65</td>
                            <td>1.9%</td>
                            <td>9.5%</td>
                            <td>95</td>
                        </tr>
                        <tr>
                            <td>10-20min</td>
                            <td>15</td>
                            <td>0.4%</td>
                            <td>8.2%</td>
                            <td>72</td>
                        </tr>
                         <tr>
                            <td>20-30min</td>
                            <td>8</td>
                            <td>0.2%</td>
                            <td>7.1%</td>
                            <td>61</td>
                        </tr>
                        <tr>
                            <td>30-60min</td>
                            <td>3</td>
                            <td>0.1%</td>
                            <td>6.5%</td>
                            <td>55</td>
                        </tr>
                        <tr>
                            <td>>60min</td>
                            <td>1</td>
                            <td>0.03%</td>
                            <td>5.3%</td>
                            <td>40</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Functions for sorting tables and downloading data
        function sortTable(columnIndex) {
            const table = document.getElementById('data-table');
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            const headers = table.querySelectorAll('th.sortable-header');
            
            // Determine sort direction
            const header = headers[columnIndex];
            const isAscending = !header.classList.contains('sorted-asc');
            
            // Reset all headers
            headers.forEach(h => {
                h.classList.remove('sorted-asc', 'sorted-desc');
            });
            
            // Set current header sort state
            if (isAscending) {
                header.classList.add('sorted-asc');
            } else {
                header.classList.add('sorted-desc');
            }
            
            // Sort rows
            rows.sort((a, b) => {
                let aValue = a.cells[columnIndex].textContent;
                let bValue = b.cells[columnIndex].textContent;
                
                // Handle percentage values
                if (aValue.includes('%')) {
                    aValue = parseFloat(aValue);
                    bValue = parseFloat(bValue);
                }
                // Handle number with commas
                else if (aValue.includes(',')) {
                    aValue = parseInt(aValue.replace(/,/g, ''));
                    bValue = parseInt(bValue.replace(/,/g, ''));
                }
                // Handle numeric comparison
                else if (!isNaN(parseFloat(aValue))) {
                    aValue = parseFloat(aValue);
                    bValue = parseFloat(bValue);
                }
                
                if (aValue < bValue) return isAscending ? -1 : 1;
                if (aValue > bValue) return isAscending ? 1 : -1;
                return 0;
            });
            
            // Reorder rows in the table
            rows.forEach(row => tbody.appendChild(row));
        }
        
        function downloadTableAsCSV(tableId) {
            const table = document.getElementById(tableId);
            const rows = table.querySelectorAll('tr');
            let csv = [];
            
            for (let i = 0; i < rows.length; i++) {
                const row = [], cols = rows[i].querySelectorAll('td, th');
                
                for (let j = 0; j < cols.length; j++) {
                    // Clean the text content (remove sort icons)
                    let text = cols[j].textContent.trim();
                    text = text.replace('↕', '');
                    
                    // Escape quotes and wrap in quotes
                    row.push('"' + text.replace(/"/g, '""') + '"');
                }
                
                csv.push(row.join(','));
            }
            
            downloadCSV(csv.join('\n'), 'video_duration_data.csv');
        }
        
        function downloadChart(chartId) {
            const canvas = document.getElementById(chartId);
            const link = document.createElement('a');
            link.download = chartId + '.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        }
        
        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        document.addEventListener('DOMContentLoaded', function () {
            const videoLengthLabels = ['0-15s', '16-30s', '31-60s', '1-3min', '3-5min', '5-10min', '10-20min', '20-30min', '30-60min', '>60min'];

            // 1. Histogram: Video Distribution by Length
            const histogramCtx = document.getElementById('histogramChart').getContext('2d');
            new Chart(histogramCtx, {
                type: 'bar',
                data: {
                    labels: videoLengthLabels,
                    datasets: [{
                        label: 'Number of Videos',
                        data: [1250, 980, 720, 350, 110, 65, 15, 8, 3, 1],
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Number of Videos' }
                        },
                        x: {
                            title: { display: true, text: 'Video Length Range' }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Video Distribution by Length',
                            font: { size: 18 }
                        }
                    }
                }
            });

            // 2. Box Plot: Video Length by Category (Sample Data)
            const boxplotCtx = document.getElementById('boxplotChart').getContext('2d');
            new Chart(boxplotCtx, {
                type: 'boxplot',
                data: {
                    labels: ['Vlog', 'Gaming', 'Tutorial', 'Music', 'News', 'Comedy', 'DIY'],
                    datasets: [{
                        label: 'Video Length Distribution (seconds)',
                        data: [
                            [60, 120, 180, 240, 300, 450, 600, 900, 100, 150, 200, 250, 350, 500],
                            [300, 600, 900, 1200, 1800, 2400, 3600, 400, 700, 1000, 1500, 2000, 3000],
                            [180, 300, 450, 600, 750, 900, 1200, 1500, 250, 400, 550, 700, 850, 1000],
                            [120, 150, 180, 210, 240, 270, 300, 330, 140, 160, 190, 220, 250, 280],
                            [30, 45, 60, 90, 120, 150, 180, 40, 50, 70, 100, 130, 160],
                            [90, 120, 150, 180, 210, 240, 300, 100, 130, 160, 190, 220, 250],
                            [240, 360, 480, 600, 720, 900, 300, 420, 540, 660, 780, 840]
                        ],
                        backgroundColor: 'rgba(255, 99, 132, 0.6)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            title: { display: true, text: 'Video Length (seconds)' }
                        },
                        x: {
                            title: { display: true, text: 'Video Category' }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Video Length by Category',
                            font: { size: 18 }
                        }
                    }
                }
            });

            // 3. Line Chart: Engagement by Video Length
            const engagementCtx = document.getElementById('engagementChart').getContext('2d');
            new Chart(engagementCtx, {
                type: 'line',
                data: {
                    labels: videoLengthLabels,
                    datasets: [
                        {
                            label: 'Avg. Interaction Rate (%)',
                            data: [8.5, 9.2, 10.1, 12.5, 11.8, 9.5, 8.2, 7.1, 6.5, 5.3],
                            borderColor: 'rgba(255, 159, 64, 1)',
                            backgroundColor: 'rgba(255, 159, 64, 0.2)',
                            yAxisID: 'y',
                            tension: 0.1
                        },
                        // 已移除观众保留率数据集
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            position: 'left',
                            title: { display: true, text: 'Rate (%)' }
                        },
                        x: {
                           title: { display: true, text: 'Video Length Range' }
                        }
                    },
                    plugins: {
                        legend: { position: 'top' },
                        title: {
                            display: true,
                            text: 'Engagement by Video Length',
                            font: { size: 18 }
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>
