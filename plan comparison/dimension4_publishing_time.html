<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Publishing Time</title>
    <link rel="stylesheet" href="common.css">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
</head>
<body>
    <div class="dashboard-container">
        <!-- Main Charts Row -->
        <div class="charts-row">
            <!-- Dual Line Chart -->
            <div class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">Hourly Engagement Rate</div>
                    <div class="chart-controls">
                        <button class="download-btn" onclick="downloadChart('hourlyEngagementChart')" title="Download Chart">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="hourlyEngagementChart" class="chart"></div>
            </div>

            <!-- Heatmap Matrix -->
            <div class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">Engagement Patterns</div>
                    <div class="chart-controls">
                        <button class="download-btn" onclick="downloadChart('weeklyHeatmapChart')" title="Download Chart">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="weeklyHeatmapChart" class="chart"></div>
            </div>
        </div>

        <!-- Secondary Charts Grid -->
        <div class="charts-grid">
            <!-- Box Plot -->
            <div class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">Engagement Rate Distribution by Time Slot</div>
                    <div class="chart-controls">
                        <button class="download-btn" onclick="downloadChart('boxplotChart')" title="Download Chart">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="boxplotChart" class="chart"></div>
            </div>

            <!-- Gantt Chart -->
            <div class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">Top 3 Golden Windows</div>
                    <div class="chart-controls">
                        <button class="download-btn" onclick="downloadChart('ganttChart')" title="Download Chart">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="ganttChart" class="chart"></div>
            </div>
        </div>

        <!-- Data Table Section -->
        <div class="data-section">
            <div class="section-header">
                <div class="section-title">Publishing Time Performance Data</div>
                <button class="download-btn" onclick="downloadTableData('dataTable')" title="Download Table Data">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                    </svg>
                    Download CSV
                </button>
            </div>
            <div class="data-table-container">
                <table class="data-table" id="dataTable">
                    <thead>
                        <tr>
                            <th>Plan</th>
                            <th>Time Slot</th>
                            <th>Posts</th>
                            <th>Avg ER</th>
                            <th>Avg ER QoQ</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody">
                        <!-- Plan A data -->
                        <tr>
                            <td rowspan="6">Plan A</td>
                            <td>Morning (6-9 AM)</td>
                            <td>42</td>
                            <td>12.5%</td>
                            <td class="metric-change positive">▲3.2%</td>
                        </tr>
                        <tr>
                            <td>Midday (10 AM-1 PM)</td>
                            <td>38</td>
                            <td>14.8%</td>
                            <td class="metric-change positive">▲4.5%</td>
                        </tr>
                        <tr>
                            <td>Afternoon (2-5 PM)</td>
                            <td>45</td>
                            <td>13.2%</td>
                            <td class="metric-change positive">▲2.8%</td>
                        </tr>
                        <tr>
                            <td>Evening (6-9 PM)</td>
                            <td>52</td>
                            <td>16.7%</td>
                            <td class="metric-change positive">▲5.4%</td>
                        </tr>
                        <tr>
                            <td>Night (10 PM-1 AM)</td>
                            <td>35</td>
                            <td>15.3%</td>
                            <td class="metric-change positive">▲4.1%</td>
                        </tr>
                        <tr>
                            <td>Late Night (2-5 AM)</td>
                            <td>18</td>
                            <td>9.8%</td>
                            <td class="metric-change negative">▼1.2%</td>
                        </tr>
                        <!-- Plan B data -->
                        <tr>
                            <td rowspan="6">Plan B</td>
                            <td>Morning (6-9 AM)</td>
                            <td>38</td>
                            <td>11.8%</td>
                            <td class="metric-change positive">▲2.5%</td>
                        </tr>
                        <tr>
                            <td>Midday (10 AM-1 PM)</td>
                            <td>35</td>
                            <td>13.9%</td>
                            <td class="metric-change positive">▲3.8%</td>
                        </tr>
                        <tr>
                            <td>Afternoon (2-5 PM)</td>
                            <td>42</td>
                            <td>12.5%</td>
                            <td class="metric-change positive">▲2.2%</td>
                        </tr>
                        <tr>
                            <td>Evening (6-9 PM)</td>
                            <td>48</td>
                            <td>15.8%</td>
                            <td class="metric-change positive">▲4.7%</td>
                        </tr>
                        <tr>
                            <td>Night (10 PM-1 AM)</td>
                            <td>32</td>
                            <td>14.5%</td>
                            <td class="metric-change positive">▲3.6%</td>
                        </tr>
                        <tr>
                            <td>Late Night (2-5 AM)</td>
                            <td>15</td>
                            <td>9.2%</td>
                            <td class="metric-change negative">▼1.8%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="common.js"></script>
    <script>
        // Initialize charts
        const hourlyEngagementChart = echarts.init(document.getElementById('hourlyEngagementChart'));
        const weeklyHeatmapChart = echarts.init(document.getElementById('weeklyHeatmapChart'));
        const boxplotChart = echarts.init(document.getElementById('boxplotChart'));
        const ganttChart = echarts.init(document.getElementById('ganttChart'));

        // Hourly Engagement Rate Chart
        const hourlyEngagementOption = {
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'cross'
                },
                formatter: function(params) {
                    let html = `${params[0].axisValue}:00<br/>`;
                    
                    params.forEach(item => {
                        const isPlanA = item.seriesName.includes('Plan A');
                        const isCurrent = !item.seriesName.includes('Previous');
                        
                        if (isCurrent) {
                            const planAChanges = Array(24).fill(0).map(() => Math.random() > 0.8 ? 
                                `▼${(Math.random() * 2).toFixed(1)}%` : 
                                `▲${(Math.random() * 5).toFixed(1)}%`);
                            
                            const planBChanges = Array(24).fill(0).map(() => Math.random() > 0.8 ? 
                                `▼${(Math.random() * 2).toFixed(1)}%` : 
                                `▲${(Math.random() * 4).toFixed(1)}%`);
                            
                            const change = isPlanA ? planAChanges[params[0].dataIndex] : planBChanges[params[0].dataIndex];
                            const changeColor = change.includes('▲') ? '#28a745' : '#dc3545';
                            
                            html += `<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:${item.color};"></span>`;
                            html += `${item.seriesName}: ${item.value}%`;
                            html += ` <span style="color:${changeColor}">${change}</span><br/>`;
                        } else {
                            html += `<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:${item.color};"></span>`;
                            html += `${item.seriesName}: ${item.value}%<br/>`;
                        }
                    });
                    
                    return html;
                }
            },
            legend: {
                data: ['Plan A', 'Plan A (Previous)', 'Plan B', 'Plan B (Previous)'],
                bottom: 0
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '15%',
                containLabel: true
            },
            xAxis: {
                type: 'category',
                boundaryGap: false,
                data: Array.from({length: 24}, (_, i) => i),
                axisLabel: {
                    formatter: '{value}:00'
                }
            },
            yAxis: {
                type: 'value',
                axisLabel: {
                    formatter: '{value}%'
                },
                min: 0
            },
            series: [
                {
                    name: 'Plan A',
                    type: 'line',
                    data: [8.2, 7.5, 6.8, 6.2, 5.8, 6.5, 9.8, 12.5, 14.2, 15.1, 15.8, 16.2, 15.5, 14.8, 14.2, 13.8, 14.5, 15.8, 16.7, 16.5, 15.8, 14.5, 12.8, 10.2],
                    lineStyle: {
                        width: 3,
                        color: CHART_COLORS.planA
                    },
                    itemStyle: {
                        color: CHART_COLORS.planA
                    },
                    markLine: {
                        data: [
                            {
                                name: 'QoQ',
                                type: 'max',
                                label: {
                                    formatter: '▲5.4%',
                                    color: '#28a745'
                                }
                            }
                        ],
                        lineStyle: {
                            color: '#28a745'
                        }
                    }
                },
                {
                    name: 'Plan A (Previous)',
                    type: 'line',
                    data: [7.8, 7.1, 6.5, 5.9, 5.5, 6.2, 9.3, 11.8, 13.5, 14.3, 15.0, 15.4, 14.7, 14.0, 13.5, 13.1, 13.8, 15.0, 15.8, 15.6, 15.0, 13.8, 12.2, 9.7],
                    lineStyle: {
                        width: 2,
                        type: 'dashed',
                        color: CHART_COLORS.planA,
                        opacity: 0.5
                    },
                    itemStyle: {
                        color: CHART_COLORS.planA,
                        opacity: 0.5
                    }
                },
                {
                    name: 'Plan B',
                    type: 'line',
                    data: [7.8, 7.1, 6.5, 5.9, 5.5, 6.2, 9.3, 11.8, 13.5, 14.3, 15.0, 15.4, 14.7, 14.0, 13.5, 13.1, 13.8, 15.0, 15.8, 15.6, 15.0, 13.8, 12.2, 9.7],
                    lineStyle: {
                        width: 3,
                        color: CHART_COLORS.planB
                    },
                    itemStyle: {
                        color: CHART_COLORS.planB
                    },
                    markLine: {
                        data: [
                            {
                                name: 'QoQ',
                                type: 'max',
                                label: {
                                    formatter: '▲4.7%',
                                    color: '#28a745'
                                }
                            }
                        ],
                        lineStyle: {
                            color: '#28a745'
                        }
                    }
                },
                {
                    name: 'Plan B (Previous)',
                    type: 'line',
                    data: [7.5, 6.8, 6.2, 5.6, 5.2, 5.9, 8.9, 11.3, 12.9, 13.7, 14.3, 14.7, 14.0, 13.4, 12.9, 12.5, 13.2, 14.3, 15.1, 14.9, 14.3, 13.2, 11.6, 9.3],
                    lineStyle: {
                        width: 2,
                        type: 'dashed',
                        color: CHART_COLORS.planB,
                        opacity: 0.5
                    },
                    itemStyle: {
                        color: CHART_COLORS.planB,
                        opacity: 0.5
                    }
                }
            ]
        };

        // Weekly Heatmap Chart
        const generateCombinedHeatmapData = () => {
            const planAData = generateHeatmapData('Plan A');
            const planBData = generateHeatmapData('Plan B');
            
            const combinedData = [];
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            
            days.forEach((day, dayIndex) => {
                for (let hour = 0; hour < 24; hour++) {
                    // Find Plan A data for this hour and day
                    const planAItem = planAData.find(item => item[0] === hour && item[1] === dayIndex);
                    // Find Plan B data for this hour and day
                    const planBItem = planBData.find(item => item[0] === hour && item[1] === dayIndex);
                    
                    if (planAItem) {
                        // Plan A data at hour*2 position
                        combinedData.push([hour, dayIndex * 2, planAItem[2], planAItem[3]]);
                    }
                    if (planBItem) {
                        // Plan B data at hour*2+1 position
                        combinedData.push([hour, dayIndex * 2 + 1, planBItem[2], planBItem[3]]);
                    }
                }
            });
            
            return combinedData;
        };

        const generateHeatmapData = (plan) => {
            const data = [];
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            const hours = Array.from({length: 24}, (_, i) => i);
            
            days.forEach((day, dayIndex) => {
                hours.forEach((hour) => {
                    // Generate random value with some patterns
                    let value = 5 + Math.random() * 5;
                    
                    // Add time-based patterns
                    if (hour >= 8 && hour <= 22) {
                        value += Math.random() * 5 + 5;
                    }
                    
                    // Weekend boost
                    if (dayIndex >= 5) {
                        value += Math.random() * 3 + 2;
                    }
                    
                    // Prime time boost
                    if (hour >= 18 && hour <= 21) {
                        value += Math.random() * 7 + 3;
                    }
                    
                    // Morning boost
                    if (hour >= 7 && hour <= 9) {
                        value += Math.random() * 4 + 2;
                    }
                    
                    // Plan A has slightly higher values
                    if (plan === 'Plan A') {
                        value *= 1.05;
                    }
                    
                    // Random QoQ change
                    const qoqChange = Math.random() > 0.7 ? 
                        `▼${(Math.random() * 2).toFixed(1)}%` : 
                        `▲${(Math.random() * 5).toFixed(1)}%`;
                    
                    data.push([hour, dayIndex, value.toFixed(1), qoqChange]);
                });
            });
            
            return data;
        };

        const heatmapPlanAData = generateHeatmapData('Plan A');
        const heatmapPlanBData = generateHeatmapData('Plan B');
        const heatmapCombinedData = generateCombinedHeatmapData();

        const weeklyHeatmapOption = {
            tooltip: {
                position: 'top',
                formatter: function(params) {
                    const dayIndex = Math.floor(params.value[1] / 2);
                    
                    // Generate the same date as in Y-axis
                    const today = new Date();
                    const startOfWeek = new Date(today);
                    startOfWeek.setDate(today.getDate() - today.getDay() + 1); // Monday of current week
                    
                    const currentDate = new Date(startOfWeek);
                    currentDate.setDate(startOfWeek.getDate() + dayIndex);
                    
                    const dateStr = currentDate.toLocaleDateString('en-US', { 
                        year: 'numeric', 
                        month: '2-digit', 
                        day: '2-digit' 
                    });
                    
                    const hour = params.value[0];
                    const plan = params.value[1] % 2 === 0 ? 'Plan A' : 'Plan B';
                    const er = params.value[2];
                    const qoqChange = params.value[3];
                    const changeColor = qoqChange.includes('▲') ? '#28a745' : '#dc3545';
                    
                    return `
                        <div>${dateStr}, ${hour}:00</div>
                        <div>Plan: ${plan}</div>
                        <div>ER: ${er}%</div>
                        <div>QoQ: <span style="color:${changeColor}">${qoqChange}</span></div>
                    `;
                }
            },
            grid: {
                height: '70%',
                top: '10%'
            },
            xAxis: {
                type: 'category',
                data: Array.from({length: 24}, (_, i) => i),
                splitArea: {
                    show: true
                },
                axisLabel: {
                    formatter: '{value}:00'
                }
            },
            yAxis: {
                type: 'category',
                data: Array.from({length: 14}, (_, i) => {
                    const dayIndex = Math.floor(i / 2);
                    // Generate dates for the current week (starting from today)
                    const today = new Date();
                    const startOfWeek = new Date(today);
                    startOfWeek.setDate(today.getDate() - today.getDay() + 1); // Monday of current week
                    
                    const currentDate = new Date(startOfWeek);
                    currentDate.setDate(startOfWeek.getDate() + dayIndex);
                    
                    const dateStr = currentDate.toLocaleDateString('en-US', { 
                        year: 'numeric', 
                        month: '2-digit', 
                        day: '2-digit' 
                    });
                    
                    const plan = i % 2 === 0 ? 'A' : 'B';
                    return `${dateStr} ${plan}`;
                }),
                splitArea: {
                    show: true
                },
                axisLabel: {
                    formatter: function(value) {
                        return value;
                    }
                }
            },
            series: [
                {
                    name: 'Heatmap Data',
                    type: 'heatmap',
                    data: heatmapCombinedData,
                    label: {
                        show: false
                    },
                    itemStyle: {
                        color: function(params) {
                            const value = params.value[2];
                            const intensity = Math.min(value / 20, 1);
                            const isPlanA = params.value[1] % 2 === 0;
                            
                            if (isPlanA) {
                                // Blue color scheme for Plan A
                                const r = Math.round(224 - intensity * 160);
                                const g = Math.round(243 - intensity * 110);
                                const b = Math.round(248 - intensity * 40);
                                return `rgb(${r}, ${g}, ${b})`;
                            } else {
                                // Orange color scheme for Plan B
                                const r = Math.round(255 - intensity * 50);
                                const g = Math.round(245 - intensity * 120);
                                const b = Math.round(235 - intensity * 200);
                                return `rgb(${r}, ${g}, ${b})`;
                            }
                        }
                    },
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }
            ]
        };

        // Box Plot Chart
        const boxplotOption = {
            tooltip: {
                trigger: 'item',
                axisPointer: {
                    type: 'shadow'
                },
                formatter: function(params) {
                    const timeSlots = [
                        'Morning (6-9 AM)',
                        'Midday (10 AM-1 PM)',
                        'Afternoon (2-5 PM)',
                        'Evening (6-9 PM)',
                        'Night (10 PM-1 AM)',
                        'Late Night (2-5 AM)'
                    ];
                    
                    const timeSlot = timeSlots[params.dataIndex];
                    const isPlanA = params.seriesName === 'Plan A';
                    
                    const planAChanges = ['▲3.2%', '▲4.5%', '▲2.8%', '▲5.4%', '▲4.1%', '▼1.2%'];
                    const planBChanges = ['▲2.5%', '▲3.8%', '▲2.2%', '▲4.7%', '▲3.6%', '▼1.8%'];
                    
                    const change = isPlanA ? planAChanges[params.dataIndex] : planBChanges[params.dataIndex];
                    const changeColor = change.includes('▲') ? '#28a745' : '#dc3545';
                    
                    let html = `<div style="font-weight:bold">${timeSlot} - ${params.seriesName}</div>`;
                    html += `<div>Max: ${params.value[5]}%</div>`;
                    html += `<div>Upper Quartile: ${params.value[4]}%</div>`;
                    html += `<div>Median: ${params.value[3]}%</div>`;
                    html += `<div>Lower Quartile: ${params.value[2]}%</div>`;
                    html += `<div>Min: ${params.value[1]}%</div>`;
                    html += `<div>QoQ: <span style="color:${changeColor}">${change}</span></div>`;
                    
                    return html;
                }
            },
            legend: {
                data: ['Plan A', 'Plan B'],
                bottom: 0
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '15%',
                containLabel: true
            },
            xAxis: {
                type: 'category',
                data: [
                    'Morning\n(6-9 AM)',
                    'Midday\n(10 AM-1 PM)',
                    'Afternoon\n(2-5 PM)',
                    'Evening\n(6-9 PM)',
                    'Night\n(10 PM-1 AM)',
                    'Late Night\n(2-5 AM)'
                ],
                axisLabel: {
                    interval: 0
                }
            },
            yAxis: {
                type: 'value',
                name: 'Engagement Rate (%)',
                axisLabel: {
                    formatter: '{value}%'
                }
            },
            series: [
                {
                    name: 'Plan A',
                    type: 'boxplot',
                    data: [
                        [8.5, 10.2, 11.8, 12.5, 14.2, 15.5],
                        [10.5, 12.8, 13.9, 14.8, 16.2, 17.5],
                        [9.2, 11.5, 12.4, 13.2, 14.8, 16.0],
                        [12.5, 14.8, 15.9, 16.7, 17.8, 19.2],
                        [11.2, 13.5, 14.6, 15.3, 16.5, 17.8],
                        [6.5, 7.8, 8.9, 9.8, 10.9, 12.2]
                    ],
                    itemStyle: {
                        color: CHART_COLORS.planA
                    },
                    label: {
                        show: true,
                        position: 'top',
                        formatter: function(params) {
                            const changes = ['▲3.2%', '▲4.5%', '▲2.8%', '▲5.4%', '▲4.1%', '▼1.2%'];
                            return changes[params.dataIndex];
                        },
                        color: function(params) {
                            const changes = ['▲3.2%', '▲4.5%', '▲2.8%', '▲5.4%', '▲4.1%', '▼1.2%'];
                            return changes[params.dataIndex].includes('▲') ? '#28a745' : '#dc3545';
                        }
                    }
                },
                {
                    name: 'Plan B',
                    type: 'boxplot',
                    data: [
                        [8.0, 9.8, 11.2, 11.8, 13.5, 14.8],
                        [10.0, 12.2, 13.2, 13.9, 15.5, 16.8],
                        [8.8, 10.9, 11.8, 12.5, 14.2, 15.5],
                        [12.0, 14.2, 15.2, 15.8, 17.2, 18.5],
                        [10.8, 12.9, 13.8, 14.5, 15.8, 17.2],
                        [6.0, 7.2, 8.4, 9.2, 10.2, 11.5]
                    ],
                    itemStyle: {
                        color: CHART_COLORS.planB
                    },
                    label: {
                        show: true,
                        position: 'top',
                        formatter: function(params) {
                            const changes = ['▲2.5%', '▲3.8%', '▲2.2%', '▲4.7%', '▲3.6%', '▼1.8%'];
                            return changes[params.dataIndex];
                        },
                        color: function(params) {
                            const changes = ['▲2.5%', '▲3.8%', '▲2.2%', '▲4.7%', '▲3.6%', '▼1.8%'];
                            return changes[params.dataIndex].includes('▲') ? '#28a745' : '#dc3545';
                        }
                    }
                }
            ]
        };

        // Gantt Chart - Top 3 Golden Windows
        const ganttOption = {
            tooltip: {
                trigger: 'item',
                formatter: function(params) {
                    const data = params.data;
                    const plan = params.name;
                    const timeWindow = data.timeWindow;
                    const change = data.change;
                    const changeColor = change.includes('▲') ? '#28a745' : '#dc3545';
                    
                    return `
                        <div style="font-weight:bold">${plan}</div>
                        <div style="margin-top:5px;font-weight:bold;color:${params.color}">${data.rank}: ${timeWindow}</div>
                        <div>QoQ: <span style="color:${changeColor}">${change}</span></div>
                    `;
                }
            },
            legend: {
                data: ['Plan A', 'Plan B'],
                bottom: 0
            },
            grid: {
                left: '8%',
                right: '4%',
                bottom: '15%',
                top: '10%',
                containLabel: true
            },
            xAxis: {
                type: 'value',
                axisLabel: {
                    formatter: function(value) {
                        const hour = Math.floor(value);
                        return `${hour}:00`;
                    }
                },
                min: 0,
                max: 24,
                splitLine: {
                    show: true,
                    lineStyle: {
                        type: 'dashed',
                        opacity: 0.3
                    }
                }
            },
            yAxis: {
                type: 'category',
                data: ['Plan B', 'Plan A'],
                axisLabel: {
                    fontSize: 12,
                    fontWeight: 'bold'
                }
            },
            series: [
                {
                    name: 'Plan A',
                    type: 'custom',
                    renderItem: function (params, api) {
                        const categoryIndex = api.value(0);
                        const start = api.value(1);
                        const end = api.value(2);
                        const height = api.size([0, 1])[1] * 0.6;
                        
                        const rectShape = echarts.graphic.clipRectByRect({
                            x: api.coord([start, categoryIndex])[0],
                            y: api.coord([start, categoryIndex])[1] - height / 2,
                            width: api.coord([end, categoryIndex])[0] - api.coord([start, categoryIndex])[0],
                            height: height
                        }, {
                            x: params.coordSys.x,
                            y: params.coordSys.y,
                            width: params.coordSys.width,
                            height: params.coordSys.height
                        });
                        
                        return rectShape && {
                            type: 'rect',
                            shape: rectShape,
                            style: api.style({
                                fill: api.value(3)
                            })
                        };
                    },
                    label: {
                        show: true,
                        position: 'inside',
                        formatter: function(params) {
                            return params.data.change;
                        },
                        color: '#fff',
                        fontWeight: 'bold',
                        fontSize: 11
                    },
                    encode: {
                        x: [1, 2],
                        y: 0
                    },
                    data: [
                        // Plan A data (categoryIndex: 1)
                        {
                            value: [1, 18, 21, '#28a745'], // Top 1: Evening (6-9 PM)
                            change: '▲5.4%',
                            timeWindow: 'Evening (6-9 PM)',
                            rank: 'Top 1'
                        },
                        {
                            value: [1, 10, 13, '#17a2b8'], // Top 2: Midday (10 AM-1 PM)
                            change: '▲4.5%',
                            timeWindow: 'Midday (10 AM-1 PM)',
                            rank: 'Top 2'
                        },
                        {
                            value: [1, 22, 24, '#ffc107'], // Top 3: Night (10 PM-12 AM)
                            change: '▲4.1%',
                            timeWindow: 'Night (10 PM-12 AM)',
                            rank: 'Top 3'
                        }
                    ]
                },
                {
                    name: 'Plan B',
                    type: 'custom',
                    renderItem: function (params, api) {
                        const categoryIndex = api.value(0);
                        const start = api.value(1);
                        const end = api.value(2);
                        const height = api.size([0, 1])[1] * 0.6;
                        
                        const rectShape = echarts.graphic.clipRectByRect({
                            x: api.coord([start, categoryIndex])[0],
                            y: api.coord([start, categoryIndex])[1] - height / 2,
                            width: api.coord([end, categoryIndex])[0] - api.coord([start, categoryIndex])[0],
                            height: height
                        }, {
                            x: params.coordSys.x,
                            y: params.coordSys.y,
                            width: params.coordSys.width,
                            height: params.coordSys.height
                        });
                        
                        return rectShape && {
                            type: 'rect',
                            shape: rectShape,
                            style: api.style({
                                fill: api.value(3)
                            })
                        };
                    },
                    label: {
                        show: true,
                        position: 'inside',
                        formatter: function(params) {
                            return params.data.change;
                        },
                        color: '#fff',
                        fontWeight: 'bold',
                        fontSize: 11
                    },
                    encode: {
                        x: [1, 2],
                        y: 0
                    },
                    data: [
                        // Plan B data (categoryIndex: 0)
                        {
                            value: [0, 18, 21, '#28a745'], // Top 1: Evening (6-9 PM)
                            change: '▲4.7%',
                            timeWindow: 'Evening (6-9 PM)',
                            rank: 'Top 1'
                        },
                        {
                            value: [0, 10, 13, '#17a2b8'], // Top 2: Midday (10 AM-1 PM)
                            change: '▲3.8%',
                            timeWindow: 'Midday (10 AM-1 PM)',
                            rank: 'Top 2'
                        },
                        {
                            value: [0, 22, 24, '#ffc107'], // Top 3: Night (10 PM-12 AM)
                            change: '▲3.6%',
                            timeWindow: 'Night (10 PM-12 AM)',
                            rank: 'Top 3'
                        }
                    ]
                }
            ]
        };

        // Set chart options
        hourlyEngagementChart.setOption(hourlyEngagementOption);
        weeklyHeatmapChart.setOption(weeklyHeatmapOption);
        boxplotChart.setOption(boxplotOption);
        ganttChart.setOption(ganttOption);

        // Setup chart toggles
        setupChartToggle('hourlyEngagementChart', hourlyEngagementChart, hourlyEngagementOption);

        // Resize charts when window is resized
        window.addEventListener('resize', function() {
            hourlyEngagementChart.resize();
            weeklyHeatmapChart.resize();
            boxplotChart.resize();
            ganttChart.resize();
        });
    </script>
</body>
</html>