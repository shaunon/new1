<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Category</title>
    <link rel="stylesheet" href="common.css">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
</head>
<body>
    <div class="dashboard-container">
        <!-- Main Charts Row -->
        <div class="charts-row">
            <!-- Grouped Bar Chart -->
            <div class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">Average Views by Content Category</div>
                    <div class="chart-controls">
                        <div class="toggle-buttons" id="categoryViewsChartToggle">
                            <button class="toggle-btn active" data-type="bar">Bar</button>
                            <button class="toggle-btn" data-type="line">Line</button>
                        </div>
                        <button class="download-btn" onclick="downloadChart('categoryViewsChart')" title="Download Chart">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="categoryViewsChart" class="chart"></div>
            </div>

            <!-- Bubble Chart -->
            <div class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">Views vs Engagement Rate by Category</div>
                    <div class="chart-controls">
                        <button class="download-btn" onclick="downloadChart('bubbleChart')" title="Download Chart">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="bubbleChart" class="chart"></div>
            </div>
        </div>

        <!-- Secondary Charts Grid -->
        <div class="charts-grid">
            <!-- 100% Stacked Bar Chart -->
            <div class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">Category Distribution</div>
                    <div class="chart-controls">
                        <button class="download-btn" onclick="downloadChart('stackedBarChart')" title="Download Chart">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="stackedBarChart" class="chart"></div>
            </div>

            <!-- Radar Chart -->
            <div class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">Performance Metrics by Plan</div>
                    <div class="chart-controls">
                        <button class="download-btn" onclick="downloadChart('radarChart')" title="Download Chart">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="radarChart" class="chart"></div>
            </div>
        </div>

        <!-- Data Table Section -->
        <div class="data-section">
            <div class="section-header">
                <div class="section-title">Content Category Performance Data</div>
                <button class="download-btn" onclick="downloadTableData('dataTable')" title="Download Table Data">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                    </svg>
                    Download CSV
                </button>
            </div>
            <div class="data-table-container">
                <table class="data-table" id="dataTable">
                    <thead>
                        <tr>
                            <th>Plan</th>
                            <th>Category</th>
                            <th>Posts</th>
                            <th>Avg Views</th>
                            <th>Avg Views QoQ</th>
                            <th>Avg ER</th>
                            <th>Avg ER QoQ</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody">
                        <!-- Plan A data -->
                        <tr>
                            <td rowspan="5">Plan A</td>
                            <td>Tutorial</td>
                            <td>58</td>
                            <td>65,200</td>
                            <td class="metric-change positive">▲7.3%</td>
                            <td>15.8%</td>
                            <td class="metric-change positive">▲4.2%</td>
                        </tr>
                        <tr>
                            <td>Product Review</td>
                            <td>42</td>
                            <td>72,500</td>
                            <td class="metric-change positive">▲9.1%</td>
                            <td>16.2%</td>
                            <td class="metric-change positive">▲5.8%</td>
                        </tr>
                        <tr>
                            <td>Lifestyle</td>
                            <td>65</td>
                            <td>48,300</td>
                            <td class="metric-change positive">▲3.5%</td>
                            <td>12.4%</td>
                            <td class="metric-change positive">▲2.1%</td>
                        </tr>
                        <tr>
                            <td>Entertainment</td>
                            <td>45</td>
                            <td>58,700</td>
                            <td class="metric-change positive">▲6.2%</td>
                            <td>14.5%</td>
                            <td class="metric-change positive">▲3.7%</td>
                        </tr>
                        <tr>
                            <td>Educational</td>
                            <td>35</td>
                            <td>42,100</td>
                            <td class="metric-change negative">▼2.4%</td>
                            <td>11.8%</td>
                            <td class="metric-change negative">▼1.5%</td>
                        </tr>
                        <!-- Plan B data -->
                        <tr>
                            <td rowspan="5">Plan B</td>
                            <td>Tutorial</td>
                            <td>52</td>
                            <td>61,800</td>
                            <td class="metric-change positive">▲5.2%</td>
                            <td>14.9%</td>
                            <td class="metric-change positive">▲3.1%</td>
                        </tr>
                        <tr>
                            <td>Product Review</td>
                            <td>38</td>
                            <td>68,200</td>
                            <td class="metric-change positive">▲7.5%</td>
                            <td>15.5%</td>
                            <td class="metric-change positive">▲4.3%</td>
                        </tr>
                        <tr>
                            <td>Lifestyle</td>
                            <td>58</td>
                            <td>45,100</td>
                            <td class="metric-change positive">▲2.8%</td>
                            <td>11.9%</td>
                            <td class="metric-change positive">▲1.4%</td>
                        </tr>
                        <tr>
                            <td>Entertainment</td>
                            <td>40</td>
                            <td>55,400</td>
                            <td class="metric-change positive">▲4.8%</td>
                            <td>13.8%</td>
                            <td class="metric-change positive">▲2.5%</td>
                        </tr>
                        <tr>
                            <td>Educational</td>
                            <td>30</td>
                            <td>39,500</td>
                            <td class="metric-change negative">▼3.2%</td>
                            <td>11.2%</td>
                            <td class="metric-change negative">▼2.1%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="common.js"></script>
    <script>
        // Initialize charts
        const categoryViewsChart = echarts.init(document.getElementById('categoryViewsChart'));
        const bubbleChart = echarts.init(document.getElementById('bubbleChart'));
        const stackedBarChart = echarts.init(document.getElementById('stackedBarChart'));
        const radarChart = echarts.init(document.getElementById('radarChart'));

        // Category Views Chart
        const categoryViewsOption = {
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'shadow'
                },
                formatter: function(params) {
                    const param = params[0];
                    let html = `${param.name}<br/>`;
                    
                    params.forEach(item => {
                        const planAChanges = ['▲7.3%', '▲9.1%', '▲3.5%', '▲6.2%', '▼2.4%'];
                        const planBChanges = ['▲5.2%', '▲7.5%', '▲2.8%', '▲4.8%', '▼3.2%'];
                        
                        const change = item.seriesName === 'Plan A' ? 
                            planAChanges[['Tutorial', 'Product Review', 'Lifestyle', 'Entertainment', 'Educational'].indexOf(item.name)] :
                            planBChanges[['Tutorial', 'Product Review', 'Lifestyle', 'Entertainment', 'Educational'].indexOf(item.name)];
                        
                        const changeColor = change.includes('▲') ? '#28a745' : '#dc3545';
                        
                        html += `<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:${item.color};"></span>`;
                        html += `${item.seriesName}: ${formatNumber(item.value)}`;
                        html += ` <span style="color:${changeColor}">${change}</span><br/>`;
                    });
                    
                    return html;
                }
            },
            legend: {
                data: ['Plan A', 'Plan B'],
                bottom: 0
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '15%',
                containLabel: true
            },
            xAxis: {
                type: 'category',
                data: ['Tutorial', 'Product Review', 'Lifestyle', 'Entertainment', 'Educational']
            },
            yAxis: {
                type: 'value',
                axisLabel: {
                    formatter: function(value) {
                        return formatNumber(value);
                    }
                }
            },
            series: [
                {
                    name: 'Plan A',
                    type: 'bar',
                    data: [65200, 72500, 48300, 58700, 42100],
                    itemStyle: {
                        color: CHART_COLORS.planA
                    },
                    label: {
                        show: true,
                        position: 'top',
                        formatter: function(params) {
                            const changes = ['▲7.3%', '▲9.1%', '▲3.5%', '▲6.2%', '▼2.4%'];
                            return changes[params.dataIndex];
                        },
                        color: function(params) {
                            const changes = ['▲7.3%', '▲9.1%', '▲3.5%', '▲6.2%', '▼2.4%'];
                            return changes[params.dataIndex].includes('▲') ? '#28a745' : '#dc3545';
                        }
                    }
                },
                {
                    name: 'Plan B',
                    type: 'bar',
                    data: [61800, 68200, 45100, 55400, 39500],
                    itemStyle: {
                        color: CHART_COLORS.planB
                    },
                    label: {
                        show: true,
                        position: 'top',
                        formatter: function(params) {
                            const changes = ['▲5.2%', '▲7.5%', '▲2.8%', '▲4.8%', '▼3.2%'];
                            return changes[params.dataIndex];
                        },
                        color: function(params) {
                            const changes = ['▲5.2%', '▲7.5%', '▲2.8%', '▲4.8%', '▼3.2%'];
                            return changes[params.dataIndex].includes('▲') ? '#28a745' : '#dc3545';
                        }
                    }
                }
            ]
        };

        // Bubble Chart
        const bubbleChartOption = {
            tooltip: {
                trigger: 'item',
                formatter: function(params) {
                    const isPlanA = params.seriesName === 'Plan A';
                    const categories = ['Tutorial', 'Product Review', 'Lifestyle', 'Entertainment', 'Educational'];
                    const category = categories[params.dataIndex];
                    
                    const planAChanges = ['▲7.3%', '▲9.1%', '▲3.5%', '▲6.2%', '▼2.4%'];
                    const planBChanges = ['▲5.2%', '▲7.5%', '▲2.8%', '▲4.8%', '▼3.2%'];
                    
                    const viewsChange = isPlanA ? planAChanges[params.dataIndex] : planBChanges[params.dataIndex];
                    const viewsChangeColor = viewsChange.includes('▲') ? '#28a745' : '#dc3545';
                    
                    const planAErChanges = ['▲4.2%', '▲5.8%', '▲2.1%', '▲3.7%', '▼1.5%'];
                    const planBErChanges = ['▲3.1%', '▲4.3%', '▲1.4%', '▲2.5%', '▼2.1%'];
                    
                    const erChange = isPlanA ? planAErChanges[params.dataIndex] : planBErChanges[params.dataIndex];
                    const erChangeColor = erChange.includes('▲') ? '#28a745' : '#dc3545';
                    
                    const posts = isPlanA ? 
                        [58, 42, 65, 45, 35][params.dataIndex] : 
                        [52, 38, 58, 40, 30][params.dataIndex];
                    
                    return `
                        <div style="font-weight:bold">${category} - ${params.seriesName}</div>
                        <div>Avg Views: ${formatNumber(params.value[0])} <span style="color:${viewsChangeColor}">${viewsChange}</span></div>
                        <div>Avg ER: ${params.value[1]}% <span style="color:${erChangeColor}">${erChange}</span></div>
                        <div>Posts: ${posts}</div>
                    `;
                }
            },
            legend: {
                data: ['Plan A', 'Plan B'],
                bottom: 0
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '15%',
                top: '10%',
                containLabel: true
            },
            xAxis: {
                type: 'value',
                name: 'Average Views',
                nameLocation: 'middle',
                nameGap: 30,
                axisLabel: {
                    formatter: function(value) {
                        return formatNumber(value);
                    }
                }
            },
            yAxis: {
                type: 'value',
                name: 'Engagement Rate (%)',
                nameLocation: 'middle',
                nameGap: 30
            },
            series: [
                {
                    name: 'Plan A',
                    type: 'scatter',
                    symbolSize: function(data) {
                        // Map posts count to bubble size
                        const posts = [58, 42, 65, 45, 35];
                        const index = [65200, 72500, 48300, 58700, 42100].indexOf(data[0]);
                        return posts[index] / 2;
                    },
                    data: [
                        [65200, 15.8],
                        [72500, 16.2],
                        [48300, 12.4],
                        [58700, 14.5],
                        [42100, 11.8]
                    ],
                    itemStyle: {
                        color: CHART_COLORS.planA
                    }
                },
                {
                    name: 'Plan B',
                    type: 'scatter',
                    symbolSize: function(data) {
                        // Map posts count to bubble size
                        const posts = [52, 38, 58, 40, 30];
                        const index = [61800, 68200, 45100, 55400, 39500].indexOf(data[0]);
                        return posts[index] / 2;
                    },
                    data: [
                        [61800, 14.9],
                        [68200, 15.5],
                        [45100, 11.9],
                        [55400, 13.8],
                        [39500, 11.2]
                    ],
                    itemStyle: {
                        color: CHART_COLORS.planB
                    }
                }
            ]
        };

        // 100% Stacked Bar Chart
        const stackedBarOption = {
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'shadow'
                },
                formatter: function(params) {
                    const category = params[0].axisValue;
                    let html = `${category}<br/>`;
                    
                    const planAChanges = ['▲2.5%', '▲1.8%', '▼0.9%', '▲1.2%', '▼1.5%'];
                    const planBChanges = ['▲1.9%', '▲1.2%', '▼1.3%', '▲0.8%', '▼2.1%'];
                    
                    params.forEach((item, index) => {
                        const isPlanA = item.seriesIndex === 0;
                        const change = isPlanA ? planAChanges[index] : planBChanges[index];
                        const changeColor = change.includes('▲') ? '#28a745' : '#dc3545';
                        
                        html += `<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:${item.color};"></span>`;
                        html += `${item.seriesName}: ${item.value}%`;
                        html += ` <span style="color:${changeColor}">${change}</span><br/>`;
                    });
                    
                    return html;
                }
            },
            legend: {
                data: ['Plan A', 'Plan B'],
                bottom: 0
            },
            grid: {
                left: '3%',
                right: '15%',
                bottom: '15%',
                containLabel: true
            },
            xAxis: {
                type: 'value',
                axisLabel: {
                    formatter: '{value}%'
                }
            },
            yAxis: {
                type: 'category',
                data: ['Tutorial', 'Product Review', 'Lifestyle', 'Entertainment', 'Educational']
            },
            series: [
                {
                    name: 'Plan A',
                    type: 'bar',
                    stack: 'total',
                    label: {
                        show: true,
                        formatter: '{c}%'
                    },
                    data: [23.7, 17.1, 26.5, 18.4, 14.3],
                    itemStyle: {
                        color: CHART_COLORS.planA
                    }
                },
                {
                    name: 'Plan B',
                    type: 'bar',
                    stack: 'total',
                    label: {
                        show: true,
                        formatter: '{c}%',
                        position: 'right'
                    },
                    data: [23.9, 17.4, 26.6, 18.3, 13.8],
                    itemStyle: {
                        color: CHART_COLORS.planB
                    }
                }
            ]
        };

        // Radar Chart
        const radarOption = {
            tooltip: {
                trigger: 'item'
            },
            legend: {
                data: ['Plan A', 'Plan B'],
                bottom: 0
            },
            radar: {
                indicator: [
                    { name: 'Views', max: 100 },
                    { name: 'Engagement', max: 100 },
                    { name: 'Completion Rate', max: 100 },
                    { name: 'Shares', max: 100 },
                    { name: 'Saves', max: 100 }
                ]
            },
            series: [
                {
                    name: 'Plan Comparison',
                    type: 'radar',
                    data: [
                        {
                            value: [85, 78, 65, 72, 68],
                            name: 'Plan A',
                            areaStyle: {
                                opacity: 0.3
                            },
                            lineStyle: {
                                width: 2
                            },
                            itemStyle: {
                                color: CHART_COLORS.planA
                            }
                        },
                        {
                            value: [80, 72, 62, 68, 65],
                            name: 'Plan B',
                            areaStyle: {
                                opacity: 0.3
                            },
                            lineStyle: {
                                width: 2
                            },
                            itemStyle: {
                                color: CHART_COLORS.planB
                            }
                        }
                    ]
                }
            ]
        };

        // Set chart options
        categoryViewsChart.setOption(categoryViewsOption);
        bubbleChart.setOption(bubbleChartOption);
        stackedBarChart.setOption(stackedBarOption);
        radarChart.setOption(radarOption);

        // Setup chart toggles
        setupChartToggle('categoryViewsChart', categoryViewsChart, categoryViewsOption);

        // Resize charts when window is resized
        window.addEventListener('resize', function() {
            categoryViewsChart.resize();
            bubbleChart.resize();
            stackedBarChart.resize();
            radarChart.resize();
        });
    </script>
</body>
</html>