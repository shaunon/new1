<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="https://unpkg.com/d3-sankey@0.12.3/dist/d3-sankey.min.js"></script>
    <style>
        body {
            font-family: sans-serif;
            background-color: #f0f2f5;
            color: #333;
        }
        .container {
            width: 95%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        .chart-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin-bottom: 20px;
            gap: 20px;
        }
        .main-chart {
            width: 100%;
            max-width: 100%;
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            height: 350px;
        }
        .aux-charts {
            width: 100%;
            display: flex;
            flex-direction: row;
            gap: 20px;
        }
        .aux-chart {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            flex-grow: 1;
            width: calc(50% - 10px);
            height: 300px;
        }
        h3 {
            margin-top: 0;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        thead {
            background-color: #f8f9fa;
        }
        tbody tr:hover {
            background-color: #f1f1f1;
        }
        #network-graph {
            width: 100%;
            height: 270px;
        }
        #sankey-diagram {
            width: 100%;
            height: 270px;
        }
        .node rect {
            cursor: move;
            fill-opacity: .9;
            shape-rendering: crispEdges;
        }
        .node text {
            pointer-events: none;
            text-shadow: 0 1px 0 #fff;
        }
        .link {
            fill: none;
            stroke: #000;
            stroke-opacity: .2;
        }
        .link:hover {
            stroke-opacity: .5;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="chart-container">
            <div class="main-chart">
                <h3>Top Mentioned Accounts (Bar Chart)</h3>
                <canvas id="bar-chart"></canvas>
            </div>
            <div class="aux-charts">
                <div class="aux-chart">
                    <h3>Influence Network (Network Graph)</h3>
                    <div id="network-graph"></div>
                </div>
                <div class="aux-chart">
                    <h3>Mention Traffic Flow (Sankey Diagram)</h3>
                    <div id="sankey-diagram"></div>
                </div>
            </div>
        </div>
        <table>
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Mentioned Account</th>
                    <th>Mention Count</th>
                    <th>Unique Mentioning Creators</th>
                    <th>Total Related Video Views</th>
                    <th>Mention Context/Scenario</th>
                    <th>Fan Growth 24h After Mention</th>
                    <th>Engagement Lift (%)</th>
                    <th>Mention Sentiment (Positive %)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td>@BrandA</td>
                    <td>15,234</td>
                    <td>8,123</td>
                    <td>1.2B</td>
                    <td>Collaboration</td>
                    <td>+5.2K</td>
                    <td>15.8%</td>
                    <td>92%</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>@CelebrityX</td>
                    <td>12,876</td>
                    <td>7,543</td>
                    <td>987M</td>
                    <td>Challenge</td>
                    <td>+4.1K</td>
                    <td>12.3%</td>
                    <td>88%</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>@CreatorZ</td>
                    <td>10,987</td>
                    <td>6,876</td>
                    <td>754M</td>
                    <td>Review</td>
                    <td>+3.5K</td>
                    <td>10.1%</td>
                    <td>95%</td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>@GameDevCo</td>
                    <td>9,876</td>
                    <td>5,432</td>
                    <td>612M</td>
                    <td>Collaboration</td>
                    <td>+2.8K</td>
                    <td>9.5%</td>
                    <td>89%</td>
                </tr>
                <tr>
                    <td>5</td>
                    <td>@FashionistaY</td>
                    <td>8,765</td>
                    <td>4,321</td>
                    <td>543M</td>
                    <td>Challenge</td>
                    <td>+2.1K</td>
                    <td>8.7%</td>
                    <td>91%</td>
                </tr>
                <tr>
                    <td>6</td>
                    <td>@TechGuru</td>
                    <td>7,654</td>
                    <td>3,210</td>
                    <td>432M</td>
                    <td>Review</td>
                    <td>+1.9K</td>
                    <td>7.9%</td>
                    <td>97%</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td>@FoodieChannel</td>
                    <td>6,543</td>
                    <td>2,109</td>
                    <td>321M</td>
                    <td>Collaboration</td>
                    <td>+1.5K</td>
                    <td>7.2%</td>
                    <td>94%</td>
                </tr>
                <tr>
                    <td>8</td>
                    <td>@MovieStudio</td>
                    <td>5,432</td>
                    <td>1,987</td>
                    <td>210M</td>
                    <td>Review</td>
                    <td>+1.2K</td>
                    <td>6.8%</td>
                    <td>85%</td>
                </tr>
                <tr>
                    <td>9</td>
                    <td>@TravelVlogger</td>
                    <td>4,321</td>
                    <td>1,567</td>
                    <td>189M</td>
                    <td>Challenge</td>
                    <td>+980</td>
                    <td>6.1%</td>
                    <td>93%</td>
                </tr>
                <tr>
                    <td>10</td>
                    <td>@EcoWarriors</td>
                    <td>3,210</td>
                    <td>1,123</td>
                    <td>154M</td>
                    <td>Collaboration</td>
                    <td>+760</td>
                    <td>5.5%</td>
                    <td>98%</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        // Data for charts - 减少数据量，只保留前6个
        const mentionData = [
            { account: '@BrandA', count: 15234, creators: 8123 },
            { account: '@CelebrityX', count: 12876, creators: 7543 },
            { account: '@CreatorZ', count: 10987, creators: 6876 },
            { account: '@GameDevCo', count: 9876, creators: 5432 },
            { account: '@FashionistaY', count: 8765, creators: 4321 },
            { account: '@TechGuru', count: 7654, creators: 3210 }
        ];

        // Bar Chart
        const barCtx = document.getElementById('bar-chart').getContext('2d');
        new Chart(barCtx, {
            type: 'bar',
            data: {
                labels: mentionData.map(d => d.account),
                datasets: [{
                    label: 'Mention Count',
                    data: mentionData.map(d => d.count),
                    backgroundColor: 'rgba(54, 162, 235, 0.8)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Mention Count'
                        },
                        ticks: {
                            callback: function(value) {
                                return value >= 1000 ? value/1000 + 'k' : value;
                            }
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Accounts'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `Mentions: ${context.raw.toLocaleString()}`;
                            }
                        }
                    }
                }
            }
        });

        // Network Graph - 简化数据
        const networkData = {
            nodes: [
                { id: 'BrandA', group: 1 },
                { id: 'CelebrityX', group: 1 },
                { id: 'CreatorZ', group: 1 },
                { id: 'Creator1', group: 2 },
                { id: 'Creator2', group: 2 },
                { id: 'Creator3', group: 2 }
            ],
            links: [
                { source: 'Creator1', target: 'BrandA', value: 5 },
                { source: 'Creator2', target: 'BrandA', value: 3 },
                { source: 'Creator3', target: 'CelebrityX', value: 4 },
                { source: 'Creator1', target: 'CreatorZ', value: 2 },
                { source: 'Creator2', target: 'CelebrityX', value: 1 }
            ]
        };

        // Create Network Graph
        const networkSvg = d3.select('#network-graph')
            .append('svg')
            .attr('width', '100%')
            .attr('height', '100%')
            .attr('viewBox', [0, 0, 800, 300]);

        const simulation = d3.forceSimulation(networkData.nodes)
            .force('link', d3.forceLink(networkData.links).id(d => d.id).distance(80))
            .force('charge', d3.forceManyBody().strength(-200))
            .force('center', d3.forceCenter(200, 135));

        const link = networkSvg.append('g')
            .selectAll('line')
            .data(networkData.links)
            .join('line')
            .attr('stroke', '#999')
            .attr('stroke-opacity', 0.6)
            .attr('stroke-width', d => Math.sqrt(d.value));

        const node = networkSvg.append('g')
            .selectAll('circle')
            .data(networkData.nodes)
            .join('circle')
            .attr('r', d => d.group === 1 ? 10 : 7)
            .attr('fill', d => d.group === 1 ? '#ff7f0e' : '#1f77b4')
            .call(drag(simulation));

        node.append('title')
            .text(d => d.id);

        const text = networkSvg.append('g')
            .selectAll('text')
            .data(networkData.nodes)
            .join('text')
            .text(d => d.id)
            .attr('font-size', 10)
            .attr('dx', 12)
            .attr('dy', 4);

        simulation.on('tick', () => {
            link
                .attr('x1', d => d.source.x)
                .attr('y1', d => d.source.y)
                .attr('x2', d => d.target.x)
                .attr('y2', d => d.target.y);

            node
                .attr('cx', d => d.x)
                .attr('cy', d => d.y);

            text
                .attr('x', d => d.x)
                .attr('y', d => d.y);
        });

        function drag(simulation) {
            function dragstarted(event) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                event.subject.fx = event.subject.x;
                event.subject.fy = event.subject.y;
            }
            
            function dragged(event) {
                event.subject.fx = event.x;
                event.subject.fy = event.y;
            }
            
            function dragended(event) {
                if (!event.active) simulation.alphaTarget(0);
                event.subject.fx = null;
                event.subject.fy = null;
            }
            
            return d3.drag()
                .on('start', dragstarted)
                .on('drag', dragged)
                .on('end', dragended);
        }

        // Sankey Diagram - 简化数据
        const sankeyData = {
            nodes: [
                { name: 'Creator1' },
                { name: 'Creator2' },
                { name: 'Creator3' },
                { name: 'BrandA' },
                { name: 'CelebrityX' },
                { name: 'CreatorZ' }
            ],
            links: [
                { source: 0, target: 3, value: 5000 },
                { source: 1, target: 3, value: 3000 },
                { source: 1, target: 4, value: 2000 },
                { source: 2, target: 4, value: 4000 },
                { source: 0, target: 5, value: 1500 }
            ]
        };

        // Create Sankey Diagram
        const sankeySvg = d3.select('#sankey-diagram')
            .append('svg')
            .attr('width', '100%')
            .attr('height', '100%')
            .attr('viewBox', [0, 0, 800, 300]);

        const sankey = d3.sankey()
            .nodeWidth(12)
            .nodePadding(8)
            .extent([[1, 1], [399, 269]]);

        const { nodes, links } = sankey(sankeyData);

        sankeySvg.append('g')
            .selectAll('rect')
            .data(nodes)
            .join('rect')
            .attr('x', d => d.x0)
            .attr('y', d => d.y0)
            .attr('height', d => d.y1 - d.y0)
            .attr('width', d => d.x1 - d.x0)
            .attr('fill', d => d.name.includes('Brand') || d.name.includes('Celebrity') || d.name.includes('CreatorZ') ? '#ff7f0e' : '#1f77b4')
            .attr('opacity', 0.8)
            .append('title')
            .text(d => `${d.name}\n${d.value.toLocaleString()}`);

        sankeySvg.append('g')
            .attr('fill', 'none')
            .selectAll('g')
            .data(links)
            .join('path')
            .attr('d', d3.sankeyLinkHorizontal())
            .attr('stroke', d => d.source.name.includes('Brand') || d.source.name.includes('Celebrity') || d.source.name.includes('CreatorZ') ? '#ff7f0e' : '#1f77b4')
            .attr('stroke-width', d => Math.max(1, d.width))
            .attr('stroke-opacity', 0.5)
            .style('mix-blend-mode', 'multiply')
            .append('title')
            .text(d => `${d.source.name} → ${d.target.name}\n${d.value.toLocaleString()}`);

        sankeySvg.append('g')
            .style('font', '9px sans-serif')
            .selectAll('text')
            .data(nodes)
            .join('text')
            .attr('x', d => d.x0 < 200 ? d.x1 + 6 : d.x0 - 6)
            .attr('y', d => (d.y1 + d.y0) / 2)
            .attr('dy', '0.35em')
            .attr('text-anchor', d => d.x0 < 200 ? 'start' : 'end')
            .text(d => d.name);
    </script>
</body>
</html>
