<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Upload Analytics Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            width: 1900px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }
        .dashboard {
            display: grid;
            grid-template-columns: 60% 40%;
            grid-gap: 20px;
            margin-bottom: 30px;
        }
        .chart-container {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
        }
        .chart-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #444;
            display: inline-block;
        }
        .chart-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
        .download-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        .download-btn:hover {
            background-color: #45a049;
        }
        .time-selector {
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #ddd;
            font-size: 12px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
            cursor: pointer;
        }
        th:hover {
            background-color: #e6e6e6;
        }
        th.sorted-asc::after {
            content: " ↑";
        }
        th.sorted-desc::after {
            content: " ↓";
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .data-table {
            margin-top: 30px;
            position: relative;
        }
        .data-table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #heatmap-container {
            width: 100%;
            height: 300px;
        }
        .chart-wrapper {
            height: 250px; /* Fixed height for compact charts */
            position: relative;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="chart-container">
            <div class="chart-title">Video Upload Trend (Line Chart - Compact)</div>
            <div class="chart-controls">
                <select class="time-selector" id="lineChartTimeSelector">
                    <option value="day">Daily</option>
                    <option value="week">Weekly</option>
                    <option value="month">Monthly</option>
                    <option value="year">Yearly</option>
                </select>
                <button class="download-btn" onclick="downloadChart('lineChart', 'video_upload_trend.png')">Download</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="lineChart"></canvas>
            </div>
        </div>
        <div class="chart-container">
            <div class="chart-title">Cumulative Uploads (Area Chart)</div>
            <div class="chart-controls">
                <select class="time-selector" id="areaChartTimeSelector">
                    <option value="day">Daily</option>
                    <option value="week">Weekly</option>
                    <option value="month">Monthly</option>
                    <option value="year">Yearly</option>
                </select>
                <button class="download-btn" onclick="downloadChart('areaChart', 'cumulative_uploads.png')">Download</button>
            </div>
            <div class="chart-wrapper">
                <canvas id="areaChart"></canvas>
            </div>
        </div>
    </div>
    
    <div class="chart-container">
        <div class="chart-title">Optimal Publishing Times (Calendar Heatmap)</div>
        <div class="chart-controls">
            <button class="download-btn" onclick="downloadChart('heatmap-container', 'optimal_publishing_times.png')">Download</button>
        </div>
        <div id="heatmap-container"></div>
    </div>
    
    <div class="data-table">
        <div class="data-table-header">
            <h3>Upload Date Data</h3>
            <button class="download-btn" onclick="downloadTableAsCSV('dataTable', 'upload_date_data.csv')">Download</button>
        </div>
        <table id="dataTable">
            <thead>
                <tr>
                    <th onclick="sortTable(0)">Date</th>
                    <th onclick="sortTable(1)">Day of Week</th>
                    <th onclick="sortTable(2)">Weekend/Weekday</th>
                    <th onclick="sortTable(3)">Number of Uploads</th>
                    <th onclick="sortTable(4)">New Views</th>
                    <th onclick="sortTable(5)">New Interactions</th>
                    <th onclick="sortTable(6)">Year-on-Year/Month-on-Month Growth</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>2023-06-01 08:15</td>
                    <td>Thursday</td>
                    <td>Weekday</td>
                    <td>12</td>
                    <td>45,678</td>
                    <td>3,456</td>
                    <td>YoY: +12%, MoM: +8%</td>
                </tr>
                <tr>
                    <td>2023-06-02 17:30</td>
                    <td>Friday</td>
                    <td>Weekday</td>
                    <td>18</td>
                    <td>67,890</td>
                    <td>5,678</td>
                    <td>YoY: +15%, MoM: +22%</td>
                </tr>
                <tr>
                    <td>2023-06-03 11:45</td>
                    <td>Saturday</td>
                    <td>Weekend</td>
                    <td>24</td>
                    <td>89,012</td>
                    <td>7,890</td>
                    <td>YoY: +18%, MoM: +25%</td>
                </tr>
                <tr>
                    <td>2023-06-04 14:20</td>
                    <td>Sunday</td>
                    <td>Weekend</td>
                    <td>21</td>
                    <td>78,901</td>
                    <td>6,789</td>
                    <td>YoY: +9%, MoM: +17%</td>
                </tr>
                <tr>
                    <td>2023-06-05 09:10</td>
                    <td>Monday</td>
                    <td>Weekday</td>
                    <td>15</td>
                    <td>56,789</td>
                    <td>4,567</td>
                    <td>YoY: +5%, MoM: +12%</td>
                </tr>
                <tr>
                    <td>2023-06-06 13:25</td>
                    <td>Tuesday</td>
                    <td>Weekday</td>
                    <td>16</td>
                    <td>60,123</td>
                    <td>5,123</td>
                    <td>YoY: +7%, MoM: +14%</td>
                </tr>
                <tr>
                    <td>2023-06-07 20:05</td>
                    <td>Wednesday</td>
                    <td>Weekday</td>
                    <td>9</td>
                    <td>34,567</td>
                    <td>2,345</td>
                    <td>YoY: +3%, MoM: +5%</td>
                </tr>
                <tr>
                    <td>2023-06-08 07:50</td>
                    <td>Thursday</td>
                    <td>Weekday</td>
                    <td>14</td>
                    <td>52,345</td>
                    <td>4,321</td>
                    <td>YoY: +11%, MoM: +9%</td>
                </tr>
                <tr>
                    <td>2023-06-09 16:40</td>
                    <td>Friday</td>
                    <td>Weekday</td>
                    <td>19</td>
                    <td>71,234</td>
                    <td>6,543</td>
                    <td>YoY: +14%, MoM: +20%</td>
                </tr>
                <tr>
                    <td>2023-06-10 10:30</td>
                    <td>Saturday</td>
                    <td>Weekend</td>
                    <td>26</td>
                    <td>92,345</td>
                    <td>8,765</td>
                    <td>YoY: +20%, MoM: +28%</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        // Data for different time periods
        const timeData = {
            day: {
                labels: ['Jun 1', 'Jun 2', 'Jun 3', 'Jun 4', 'Jun 5', 'Jun 6', 'Jun 7', 'Jun 8', 'Jun 9', 'Jun 10'],
                uploads: [12, 18, 24, 21, 15, 16, 9, 14, 19, 26],
                views: [45.6, 67.8, 89.0, 78.9, 56.7, 60.1, 34.5, 52.3, 71.2, 92.3],
                cumulative: [12, 30, 54, 75, 90, 106, 115, 129, 148, 174]
            },
            week: {
                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                uploads: [75, 90, 110, 95],
                views: [280.3, 320.5, 350.2, 310.8],
                cumulative: [75, 165, 275, 370]
            },
            month: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                uploads: [250, 310, 290, 320, 380, 410],
                views: [1200, 1450, 1350, 1500, 1650, 1800],
                cumulative: [250, 560, 850, 1170, 1550, 1960]
            },
            year: {
                labels: ['2019', '2020', '2021', '2022', '2023'],
                uploads: [2800, 3200, 3600, 4100, 4500],
                views: [15000, 18000, 21000, 24000, 28000],
                cumulative: [2800, 6000, 9600, 13700, 18200]
            }
        };

        // Line Chart Data - Compact Version
        let lineChart, areaChart, heatmapChart;
        
        // Function to update charts based on time period selection
        function updateCharts() {
            const lineTimePeriod = document.getElementById('lineChartTimeSelector').value;
            const areaTimePeriod = document.getElementById('areaChartTimeSelector').value;
            const heatmapTimePeriod = document.getElementById('heatmapTimeSelector').value;
            
            // Update Line Chart
            lineChart.data.labels = timeData[lineTimePeriod].labels;
            lineChart.data.datasets[0].data = timeData[lineTimePeriod].uploads;
            lineChart.data.datasets[1].data = timeData[lineTimePeriod].views;
            lineChart.update();
            
            // Update Area Chart
            areaChart.data.labels = timeData[areaTimePeriod].labels;
            areaChart.data.datasets[0].data = timeData[areaTimePeriod].cumulative;
            areaChart.update();
            
            // For heatmap, we'll just pretend to update it (actual implementation would be more complex)
            // In a real implementation, you would update the heatmap data based on the selected time period
            console.log(`Heatmap time period changed to: ${heatmapTimePeriod}`);
        }
        
        // Function to download chart as image
        function downloadChart(chartId, filename) {
            const canvas = document.getElementById(chartId);
            if (!canvas) {
                // For heatmap which has a container with canvas inside
                const container = document.getElementById(chartId);
                if (container) {
                    const canvas = container.querySelector('canvas');
                    if (canvas) {
                        const link = document.createElement('a');
                        link.download = filename;
                        link.href = canvas.toDataURL('image/png');
                        link.click();
                    }
                }
                return;
            }
            
            const link = document.createElement('a');
            link.download = filename;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }
        
        // Function to download table as CSV
        function downloadTableAsCSV(tableId, filename) {
            const table = document.getElementById(tableId);
            let csv = [];
            const rows = table.querySelectorAll('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const row = [], cols = rows[i].querySelectorAll('td, th');
                
                for (let j = 0; j < cols.length; j++) {
                    // Replace any commas in the cell text to avoid CSV parsing issues
                    let text = cols[j].innerText.replace(/,/g, ';');
                    // Wrap in quotes to handle any special characters
                    row.push('"' + text + '"');
                }
                
                csv.push(row.join(','));
            }
            
            const csvString = csv.join('\n');
            const link = document.createElement('a');
            link.href = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csvString);
            link.download = filename;
            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // Table sorting functionality
        let sortColumn = -1;
        let sortDirection = 1; // 1 for ascending, -1 for descending
        
        function sortTable(column) {
            const table = document.getElementById('dataTable');
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            
            // Reset all headers
            const headers = table.querySelectorAll('th');
            headers.forEach(header => {
                header.classList.remove('sorted-asc', 'sorted-desc');
            });
            
            // Update sort direction
            if (sortColumn === column) {
                sortDirection *= -1;
            } else {
                sortColumn = column;
                sortDirection = 1;
            }
            
            // Add sort indicator to header
            headers[column].classList.add(sortDirection === 1 ? 'sorted-asc' : 'sorted-desc');
            
            // Sort the rows
            rows.sort((a, b) => {
                const aValue = a.cells[column].innerText;
                const bValue = b.cells[column].innerText;
                
                // Check if the values are numbers (with commas)
                const aNum = parseFloat(aValue.replace(/,/g, ''));
                const bNum = parseFloat(bValue.replace(/,/g, ''));
                
                if (!isNaN(aNum) && !isNaN(bNum)) {
                    return sortDirection * (aNum - bNum);
                }
                
                // Otherwise sort as strings
                return sortDirection * aValue.localeCompare(bValue);
            });
            
            // Reorder the rows in the table
            rows.forEach(row => tbody.appendChild(row));
        }

        // Initialize Charts
        window.onload = function() {
            // Line Chart
            const lineCtx = document.getElementById('lineChart').getContext('2d');
            lineChart = new Chart(lineCtx, {
                type: 'line',
                data: {
                    labels: timeData.day.labels,
                    datasets: [{
                        label: 'Daily Uploads',
                        data: timeData.day.uploads,
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1,
                        fill: false,
                        pointRadius: 3,
                        borderWidth: 2
                    }, {
                        label: 'Daily Views (k)',
                        data: timeData.day.views,
                        borderColor: 'rgb(54, 162, 235)',
                        tension: 0.1,
                        fill: false,
                        yAxisID: 'y1',
                        pointRadius: 3,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                boxWidth: 12,
                                padding: 10,
                                font: {
                                    size: 11
                                }
                            }
                        },
                        tooltip: {
                            bodyFont: {
                                size: 11
                            },
                            titleFont: {
                                size: 12
                            }
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Uploads',
                                font: {
                                    size: 10
                                }
                            },
                            ticks: {
                                font: {
                                    size: 9
                                }
                            }
                        },
                        y1: {
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Views (k)',
                                font: {
                                    size: 10
                                }
                            },
                            ticks: {
                                font: {
                                    size: 9
                                }
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    size: 9
                                }
                            }
                        }
                    }
                }
            });

            // Area Chart
            const areaCtx = document.getElementById('areaChart').getContext('2d');
            areaChart = new Chart(areaCtx, {
                type: 'line',
                data: {
                    labels: timeData.day.labels,
                    datasets: [{
                        label: 'Cumulative Uploads',
                        data: timeData.day.cumulative,
                        backgroundColor: 'rgba(153, 102, 255, 0.2)',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        borderWidth: 1,
                        fill: true,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                boxWidth: 12,
                                padding: 10,
                                font: {
                                    size: 11
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Total Uploads',
                                font: {
                                    size: 10
                                }
                            },
                            ticks: {
                                font: {
                                    size: 9
                                }
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    size: 9
                                }
                            }
                        }
                    }
                }
            });

            // Heatmap (simplified using bar chart)
            const heatmapContainer = document.getElementById('heatmap-container');
            const heatmapCanvas = document.createElement('canvas');
            heatmapContainer.appendChild(heatmapCanvas);
            
            const heatmapCtx = heatmapCanvas.getContext('2d');
            
            // Heatmap Data
            const heatmapData = {
                // Hours 0-23 as columns
                // Days Sunday-Saturday as rows
                data: [
                    // Sun, Mon, Tue, Wed, Thu, Fri, Sat
                    [5, 3, 7, 2, 4, 6, 9],    // 0:00
                    [3, 2, 5, 1, 3, 4, 7],    // 1:00
                    [2, 1, 3, 0, 2, 2, 5],    // 2:00
                    [1, 0, 2, 0, 1, 1, 3],    // 3:00
                    [2, 1, 3, 1, 2, 2, 4],    // 4:00
                    [4, 3, 5, 2, 4, 5, 6],    // 5:00
                    [7, 8, 9, 5, 7, 8, 10],   // 6:00
                    [12, 15, 14, 8, 12, 13, 15], // 7:00
                    [15, 18, 16, 10, 14, 16, 18], // 8:00
                    [18, 20, 18, 12, 16, 18, 20], // 9:00
                    [20, 22, 20, 15, 18, 20, 23], // 10:00
                    [22, 20, 22, 18, 20, 22, 26], // 11:00
                    [20, 18, 20, 16, 18, 20, 24], // 12:00
                    [18, 16, 18, 14, 16, 18, 22], // 13:00
                    [16, 14, 16, 12, 14, 16, 20], // 14:00
                    [14, 12, 14, 10, 12, 14, 18], // 15:00
                    [12, 10, 12, 8, 10, 12, 16], // 16:00
                    [15, 12, 14, 10, 12, 19, 18], // 17:00
                    [18, 15, 16, 12, 14, 18, 20], // 18:00
                    [15, 12, 14, 10, 12, 16, 18], // 19:00
                    [12, 10, 12, 8, 10, 14, 16], // 20:00
                    [10, 8, 10, 6, 8, 12, 14], // 21:00
                    [8, 6, 8, 4, 6, 10, 12],  // 22:00
                    [6, 4, 6, 2, 4, 8, 10]    // 23:00
                ]
            };
            
            heatmapChart = new Chart(heatmapCtx, {
                type: 'bar',
                data: {
                    labels: ['Jun 4, 23', 'Jun 5, 23', 'Jun 6, 23', 'Jun 7, 23', 'Jun 8, 23', 'Jun 9, 23', 'Jun 10, 23'],
                    datasets: heatmapData.data.map((hourData, hour) => ({
                        label: `${hour}:00`,
                        data: hourData,
                        backgroundColor: hourData.map(val => {
                            const opacity = Math.min(0.2 + val/30, 0.9);
                            return `rgba(255, 99, 132, ${opacity})`;
                        }),
                        borderColor: 'rgba(255, 99, 132, 0.2)',
                        borderWidth: 1
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true,
                            ticks: {
                                font: {
                                    size: 10
                                }
                            }
                        },
                        y: {
                            stacked: true,
                            title: {
                                display: true,
                                text: 'Number of Uploads',
                                font: {
                                    size: 11
                                }
                            },
                            ticks: {
                                font: {
                                    size: 9
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return `${context[0].dataset.label}-${context[0].label}`;
                                },
                                label: function(context) {
                                    return `Uploads: ${context.raw}`;
                                }
                            },
                            bodyFont: {
                                size: 11
                            }
                        }
                    }
                }
            });
            
            // Add event listeners for time period selectors
            document.getElementById('lineChartTimeSelector').addEventListener('change', updateCharts);
            document.getElementById('areaChartTimeSelector').addEventListener('change', updateCharts);
        };
    </script>
</body>
</html>
