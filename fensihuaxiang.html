<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audience Profile Analysis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.css">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f8f9fa;
            color: #333;
            max-width: 1900px;
            margin: 0 auto;
        }

        .card {
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            transition: transform 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .card-header {
            background-color: #f1f5f9;
            border-bottom: none;
            font-weight: bold;
        }
        .progress {
            height: 20px;
            margin-bottom: 10px;
        }
        .progress-bar {
            background-color: #6a11cb;
        }
    </style>
</head>
<body>
    <div class="container">

        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">Gender Distribution</div>
                    <div class="card-body">
                        <canvas id="gendersChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">Ethnicity Distribution</div>
                    <div class="card-body">
                        <canvas id="ethnicitiesChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">Language Distribution</div>
                    <div class="card-body">
                        <canvas id="languagesChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">Country Distribution</div>
                    <div class="card-body">
                        <canvas id="countriesChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">City Distribution (Top 10)</div>
                    <div class="card-body">
                        <div id="cities-container">
                            <!-- City distribution will be loaded dynamically via JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">Audience Credibility & Notability</div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h5>Audience Credibility</h5>
                                <div class="progress">
                                    <div class="progress-bar" id="credibility-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <p id="credibility-text" class="text-center"></p>
                            </div>
                            <div class="col-md-6">
                                <h5>Audience Notability</h5>
                                <div class="progress">
                                    <div class="progress-bar" id="notable-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <p id="notable-text" class="text-center"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script>
        // Directly embedded audience data
        const audienceData = {
            "languages": [
                {
                    "code": "ar",
                    "name": "Arabic",
                    "weight": 0.720539
                },
                {
                    "code": "en",
                    "name": "English",
                    "weight": 0.188034
                },
                {
                    "code": "fr",
                    "name": "French",
                    "weight": 0.037037
                },
                {
                    "code": "arz",
                    "name": "Arabic (Egyptian)",
                    "weight": 0.010878
                },
                {
                    "code": "tr",
                    "name": "Turkish",
                    "weight": 0.007252
                }
            ],
            "ethnicities": [
                {
                    "code": "african_american",
                    "name": "African American",
                    "weight": 0.025624
                },
                {
                    "code": "white",
                    "name": "White / Caucasian",
                    "weight": 0.888296
                },
                {
                    "code": "asian",
                    "name": "Asian",
                    "weight": 0.085413
                },
                {
                    "code": "hispanic",
                    "name": "Hispanic",
                    "weight": 0.000667
                }
            ],
            "credibility": 0.7238,
            "notable": 0.0742,
            "genders": [
                {
                    "code": "FEMALE",
                    "weight": 0.766484
                },
                {
                    "code": "MALE",
                    "weight": 0.233516
                }
            ],
            "geoCities": [
                {
                    "name": "Baghdad",
                    "weight": 0.046667,
                    "country": "Iraq"
                },
                {
                    "name": "Jeddah",
                    "weight": 0.024,
                    "country": "Saudi Arabia"
                },
                {
                    "name": "Istanbul",
                    "weight": 0.022667,
                    "country": "Turkey"
                },
                {
                    "name": "Riyadh",
                    "weight": 0.019333,
                    "country": "Saudi Arabia"
                },
                {
                    "name": "Algiers",
                    "weight": 0.018,
                    "country": "Algeria"
                },
                {
                    "name": "Casablanca",
                    "weight": 0.016667,
                    "country": "Morocco"
                },
                {
                    "name": "Dubai",
                    "weight": 0.012667,
                    "country": "United Arab Emirates"
                },
                {
                    "name": "Basra",
                    "weight": 0.012,
                    "country": "Iraq"
                },
                {
                    "name": "Mecca",
                    "weight": 0.010667,
                    "country": "Saudi Arabia"
                },
                {
                    "name": "Oran",
                    "weight": 0.01,
                    "country": "Algeria"
                }
            ],
            "geoCountries": [
                {
                    "name": "Iraq",
                    "code": "IQ",
                    "weight": 0.109333
                },
                {
                    "name": "Saudi Arabia",
                    "code": "SA",
                    "weight": 0.106667
                },
                {
                    "name": "Morocco",
                    "code": "MA",
                    "weight": 0.095333
                },
                {
                    "name": "Algeria",
                    "code": "DZ",
                    "weight": 0.079333
                },
                {
                    "name": "Tunisia",
                    "code": "TN",
                    "weight": 0.063333
                }
            ]
        };
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            renderAudienceData(audienceData);
        });

        // Render audience data
        function renderAudienceData(audience) {
            console.log('Rendering audience data:', audience);
            
            // Render gender distribution
            if (audience.genders && audience.genders.length > 0) {
                renderGendersChart(audience.genders);
            }
            
            // Render ethnicity distribution
            if (audience.ethnicities && audience.ethnicities.length > 0) {
                renderEthnicitiesChart(audience.ethnicities);
            }
            
            // Render language distribution
            if (audience.languages && audience.languages.length > 0) {
                renderLanguagesChart(audience.languages);
            }
            
            // Render country distribution
            if (audience.geoCountries && audience.geoCountries.length > 0) {
                renderCountriesChart(audience.geoCountries);
            }
            
            // Render city distribution
            if (audience.geoCities && audience.geoCities.length > 0) {
                renderCitiesDistribution(audience.geoCities);
            }
            
            // Render credibility and notability
            if (audience.credibility !== undefined && audience.notable !== undefined) {
                renderCredibilityAndNotable(audience.credibility, audience.notable);
            }
        }

        // Format number
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num;
        }

        // Render gender distribution chart
        function renderGendersChart(genders) {
            const ctx = document.getElementById('gendersChart').getContext('2d');
            const labels = genders.map(item => item.code === 'FEMALE' ? 'Female' : item.code === 'MALE' ? 'Male' : item.name);
            const data = genders.map(item => item.weight * 100);
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                font: {
                                    size: 14
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.raw.toFixed(1) + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Render ethnicity distribution chart
        function renderEthnicitiesChart(ethnicities) {
            const ctx = document.getElementById('ethnicitiesChart').getContext('2d');
            const labels = ethnicities.map(item => item.name);
            const data = ethnicities.map(item => item.weight * 100);
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: ['#8B5CF6', '#EC4899', '#10B981', '#F59E0B', '#3B82F6', '#EF4444'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                font: {
                                    size: 14
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.raw.toFixed(1) + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Render language distribution chart
        function renderLanguagesChart(languages) {
            const ctx = document.getElementById('languagesChart').getContext('2d');
            // Only take top 5 languages
            const topLanguages = languages.slice(0, 5);
            const labels = topLanguages.map(item => item.name || item.code);
            const data = topLanguages.map(item => item.weight * 100);
            
            const gradientBg = ctx.createLinearGradient(0, 0, 0, 400);
            gradientBg.addColorStop(0, '#6a11cb');
            gradientBg.addColorStop(1, '#2575fc');
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Language Distribution (%)',
                        data: data,
                        backgroundColor: gradientBg,
                        borderRadius: 6
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.raw.toFixed(1) + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // Render country distribution chart
        function renderCountriesChart(countries) {
            const ctx = document.getElementById('countriesChart').getContext('2d');
            // Only take top 5 countries
            const topCountries = countries.slice(0, 5);
            const labels = topCountries.map(item => item.name || item.code);
            const data = topCountries.map(item => item.weight * 100);
            
            const gradientBg = ctx.createLinearGradient(0, 0, 0, 400);
            gradientBg.addColorStop(0, '#2575fc');
            gradientBg.addColorStop(1, '#6a11cb');
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Country Distribution (%)',
                        data: data,
                        backgroundColor: gradientBg,
                        borderRadius: 6
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.raw.toFixed(1) + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // Render city distribution
        function renderCitiesDistribution(cities) {
            const container = document.getElementById('cities-container');
            container.innerHTML = '';
            
            // Only take top 10 cities
            const topCities = cities.slice(0, 10);
            
            topCities.forEach(city => {
                const row = document.createElement('div');
                row.classList.add('mb-3');
                
                const cityName = city.name || city.code || 'Unknown City';
                const countryName = city.country || '';
                const percentage = (city.weight * 100).toFixed(1);
                
                const content = `
                    <div class="d-flex justify-content-between mb-1">
                        <span>${cityName}${countryName ? ', ' + countryName : ''}</span>
                        <span>${percentage}%</span>
                    </div>
                    <div class="progress">
                                <div class="progress-bar bg-gradient" role="progressbar" 
                                    style="width: ${percentage}%; background: linear-gradient(to right, #6a11cb, #2575fc, #00d2ff);" 
                                    aria-valuenow="${percentage}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                `;
                
                row.innerHTML = content;
                container.appendChild(row);
            });
        }

        // Render credibility and notability
        function renderCredibilityAndNotable(credibility, notable) {
            const credibilityPercentage = (credibility * 100).toFixed(1);
            const notablePercentage = (notable * 100).toFixed(1);
            
            // Set progress bars
            document.getElementById('credibility-bar').style.width = credibilityPercentage + '%';
            document.getElementById('credibility-bar').setAttribute('aria-valuenow', credibilityPercentage);
            document.getElementById('credibility-text').textContent = credibilityPercentage + '%';
            document.getElementById('credibility-bar').style.background = 'linear-gradient(to right, #6a11cb, #2575fc)';
            
            document.getElementById('notable-bar').style.width = notablePercentage + '%';
            document.getElementById('notable-bar').setAttribute('aria-valuenow', notablePercentage);
            document.getElementById('notable-text').textContent = notablePercentage + '%';
            document.getElementById('notable-bar').style.background = 'linear-gradient(to right, #2575fc, #6a11cb)';
        }
    </script>
</body>
</html>
