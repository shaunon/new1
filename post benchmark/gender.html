<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"></script>
    <script>
        // Register themeRiver chart
        if (typeof echarts !== 'undefined') {
            echarts.registerChart = echarts.registerChart || function() {};
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .section {
            margin-bottom: 40px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        
        .section-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        
        .chart-container {
            width: 100%;
            height: 500px;
            margin-bottom: 20px;
        }
        
        .chart-controls {
            margin-bottom: 20px;
            text-align: center;
        }
        
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 0 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .btn.active {
            background: #e74c3c;
        }
        
        .stacked-charts {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stacked-chart {
            height: 400px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .data-table th,
        .data-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        .data-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .data-table tr:hover {
            background-color: #e8f4f8;
        }
        
        .positive {
            color: #27ae60;
            font-weight: 600;
        }
        
        .negative {
            color: #e74c3c;
            font-weight: 600;
        }
        
        @media (max-width: 768px) {
            .stacked-charts {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                height: 400px;
            }
            
            .stacked-chart {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- River Chart / Area Chart Section -->
        <div class="section">
            <h2 class="section-title">Genders - Post Count & Period-over-Period Comparison</h2>
            <div class="chart-controls">
                <button class="btn active" onclick="toggleRiverChart('themeriver')">Theme River</button>
                <button class="btn" onclick="toggleRiverChart('area')">Area Chart</button>
            </div>
            <div id="riverChart" class="chart-container"></div>
        </div>

        <!-- Stacked Bar Charts Section -->
        <div class="section">
            <h2 class="section-title">Distribution Analysis</h2>
            <div class="stacked-charts">
                <div id="platformChart" class="stacked-chart"></div>
                <div id="countryChart" class="stacked-chart"></div>
                <div id="languageChart" class="stacked-chart"></div>
                <div id="sentimentChart" class="stacked-chart"></div>
            </div>
        </div>

        <!-- Word Cloud / Sunburst Chart Section -->
        <div class="section">
            <h2 class="section-title">Top 100 Genders Visualization</h2>
            <div class="chart-controls">
                <button class="btn active" onclick="toggleWordChart('wordcloud')">Word Cloud</button>
                <button class="btn" onclick="toggleWordChart('sunburst')">Sunburst Chart</button>
            </div>
            <div id="wordChart" class="chart-container"></div>
        </div>

        <!-- Data Table Section -->
        <div class="section">
            <h2 class="section-title">Gender Performance Metrics</h2>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Gender</th>
                        <th>Authors</th>
                        <th>Authors (MoM %)</th>
                        <th>Posts</th>
                        <th>Posts (MoM %)</th>
                        <th>Interactions</th>
                        <th>Interactions (MoM %)</th>
                        <th>Net Sentiment</th>
                        <th>Sentiment (MoM %)</th>
                    </tr>
                </thead>
                <tbody id="dataTableBody">
                    <!-- Data will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Sample data - replace with actual data
        const hashtagData = {
            themeRiver: [
                ['2024-01-01', 120, 'male', 14.3],
                ['2024-01-02', 132, 'male', 10.0],
                ['2024-01-03', 101, 'male', -23.5],
                ['2024-01-04', 134, 'male', 32.7],
                ['2024-01-05', 90, 'male', -32.8],
                ['2024-01-06', 230, 'male', 155.6],
                ['2024-01-07', 210, 'male', -8.7],
                ['2024-01-01', 220, 'female', -2.1],
                ['2024-01-02', 182, 'female', -17.3],
                ['2024-01-03', 191, 'female', 4.9],
                ['2024-01-04', 234, 'female', 22.5],
                ['2024-01-05', 290, 'female', 23.9],
                ['2024-01-06', 330, 'female', 13.8],
                ['2024-01-07', 310, 'female', -6.1],
                ['2024-01-01', 150, 'non-binary', 6.2],
                ['2024-01-02', 232, 'non-binary', 54.7],
                ['2024-01-03', 201, 'non-binary', -13.4],
                ['2024-01-04', 154, 'non-binary', -23.4],
                ['2024-01-05', 190, 'non-binary', 23.4],
                ['2024-01-06', 330, 'non-binary', 73.7],
                ['2024-01-07', 410, 'non-binary', 24.2]
            ],
            platforms: {
                categories: ['male', 'female', 'non-binary'],
                series: [
                    { name: 'TikTok', data: [320, 302, 301], mom: [12.5, -3.2, 8.7] },
                    { name: 'Instagram', data: [120, 132, 101], mom: [8.3, 15.7, -12.4] },
                    { name: 'YouTube', data: [220, 182, 191], mom: [5.6, -2.4, 18.9] },
                    { name: 'Twitter', data: [150, 232, 201], mom: [12.1, 22.3, -1.2] },
                    { name: 'Facebook', data: [862, 1018, 964], mom: [3.8, 9.1, 4.2] }
                ]
            },
            countries: {
                categories: ['male', 'female', 'non-binary'],
                series: [
                    { name: 'USA', data: [420, 402, 401], mom: [15.2, 8.9, 12.3] },
                    { name: 'UK', data: [220, 232, 201], mom: [7.8, 14.2, -5.6] },
                    { name: 'Canada', data: [150, 182, 191], mom: [3.4, 12.7, 8.1] },
                    { name: 'Australia', data: [120, 132, 101], mom: [9.1, 6.5, -8.9] },
                    { name: 'Others', data: [762, 918, 864], mom: [5.7, 13.4, 7.2] }
                ]
            },
            languages: {
                categories: ['male', 'female', 'non-binary'],
                series: [
                    { name: 'English', data: [520, 502, 501], mom: [12.8, 6.7, 9.4] },
                    { name: 'Spanish', data: [220, 232, 201], mom: [8.9, 15.6, -3.2] },
                    { name: 'French', data: [150, 182, 191], mom: [4.3, 11.8, 7.6] },
                    { name: 'German', data: [120, 132, 101], mom: [6.7, 8.2, -7.4] },
                    { name: 'Others', data: [662, 818, 764], mom: [7.1, 12.9, 5.8] }
                ]
            },
            sentiments: {
                categories: ['male', 'female', 'non-binary'],
                series: [
                    { name: 'Positive', data: [620, 602, 601], mom: [14.3, 8.1, 11.7] },
                    { name: 'Neutral', data: [320, 332, 301], mom: [6.2, 9.8, 4.5] },
                    { name: 'Negative', data: [120, 132, 101], mom: [-2.1, 5.4, -8.7] }
                ]
            },
            wordcloud: [
                { name: 'male', value: 1500 },
                { name: 'female', value: 1200 },
                { name: 'non-binary', value: 1000 },
                { name: 'transgender', value: 700 },
                { name: 'genderfluid', value: 650 },
                { name: 'agender', value: 600 },
                { name: 'demigender', value: 550 },
                { name: 'bigender', value: 500 },
                { name: 'genderqueer', value: 450 },
                { name: 'pangender', value: 400 }
                // Add more gender identities up to 100
            ],
            table: [
                { gender: 'male', authors: 15420, authorsMoM: 12.5, posts: 45230, postsMoM: 8.3, interactions: 2340000, interactionsMoM: 15.7, sentiment: 0.75, sentimentMoM: 2.1 },
                { gender: 'female', authors: 12340, authorsMoM: -3.2, posts: 38920, postsMoM: 5.6, interactions: 1890000, interactionsMoM: -2.4, sentiment: 0.82, sentimentMoM: 1.8 },
                { gender: 'non-binary', authors: 9870, authorsMoM: 18.9, posts: 32450, postsMoM: 12.1, interactions: 1560000, interactionsMoM: 22.3, sentiment: 0.68, sentimentMoM: -1.2 }
            ]
        };

        let currentRiverType = 'themeriver';
        let currentWordType = 'wordcloud';

        // Initialize charts
        function initCharts() {
            initRiverChart();
            initStackedCharts();
            initWordChart();
            populateDataTable();
        }

        // River Chart / Area Chart
        function initRiverChart() {
            const chart = echarts.init(document.getElementById('riverChart'));
            updateRiverChart(chart);
        }

        function updateRiverChart(chart) {
            // Clear the chart first to prevent overlapping
            chart.clear();
            
            let option;
            
            if (currentRiverType === 'themeriver') {
                option = {
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'line'
                        },
                        formatter: function(params) {
                            let result = params[0].data[0] + '<br/>';
                            params.forEach(param => {
                                const momValue = param.data[3];
                                const momClass = momValue >= 0 ? 'positive' : 'negative';
                                const momSign = momValue >= 0 ? '+' : '';
                                result += param.data[2] + ': ' + param.data[1] + 
                                         ' <span style="color: ' + (momValue >= 0 ? '#52c41a' : '#ff4d4f') + '">(' + 
                                         momSign + momValue + '%)</span><br/>';
                            });
                            return result;
                        }
                    },
                    legend: {
                        data: ['male', 'female', 'non-binary']
                    },
                    singleAxis: {
                        type: 'time',
                        top: 50,
                        bottom: 50,
                        axisPointer: {
                            animation: true,
                            label: {
                                show: true
                            }
                        }
                    },
                    series: [{
                        type: 'themeRiver',
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 20,
                                shadowColor: 'rgba(0, 0, 0, 0.8)'
                            }
                        },
                        data: hashtagData.themeRiver
                    }]
                };
            } else {
                // Area chart fallback
                const processedData = hashtagData.themeRiver.reduce((acc, item) => {
                    const [date, value, name, mom] = item;
                    if (!acc[name]) {
                        acc[name] = [];
                    }
                    acc[name].push([date, value, mom]);
                    return acc;
                }, {});

                const series = Object.keys(processedData).map(name => ({
                    name: name,
                    type: 'line',
                    stack: 'Total',
                    areaStyle: {},
                    emphasis: {
                        focus: 'series'
                    },
                    data: processedData[name]
                }));

                option = {
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'cross',
                            label: {
                                backgroundColor: '#6a7985'
                            }
                        },
                        formatter: function(params) {
                            let result = params[0].axisValue + '<br/>';
                            params.forEach(param => {
                                const momValue = param.data[2];
                                const momSign = momValue >= 0 ? '+' : '';
                                result += param.seriesName + ': ' + param.data[1] + 
                                         ' <span style="color: ' + (momValue >= 0 ? '#52c41a' : '#ff4d4f') + '">(' + 
                                         momSign + momValue + '%)</span><br/>';
                            });
                            return result;
                        }
                    },
                    legend: {
                        data: Object.keys(processedData)
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true
                    },
                    xAxis: {
                        type: 'time',
                        boundaryGap: false
                    },
                    yAxis: {
                        type: 'value'
                    },
                    series: series
                };
            }
            
            chart.setOption(option);
        }

        function toggleRiverChart(type) {
            currentRiverType = type;
            document.querySelectorAll('.section:first-child .chart-controls .btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const chart = echarts.getInstanceByDom(document.getElementById('riverChart'));
            updateRiverChart(chart);
        }

        // Stacked Bar Charts
        function initStackedCharts() {
            initStackedChart('platformChart', 'Platform Distribution', hashtagData.platforms);
            initStackedChart('countryChart', 'Country Distribution', hashtagData.countries);
            initStackedChart('languageChart', 'Language Distribution', hashtagData.languages);
            initStackedChart('sentimentChart', 'Sentiment Distribution', hashtagData.sentiments);
        }

        function initStackedChart(containerId, title, data) {
            const chart = echarts.init(document.getElementById(containerId));
            const option = {
                title: {
                    text: title,
                    left: 'center',
                    textStyle: {
                        fontSize: 16,
                        fontWeight: 'bold'
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    },
                    formatter: function(params) {
                        let result = params[0].name + '<br/>';
                        params.forEach((param, index) => {
                            const seriesData = data.series.find(s => s.name === param.seriesName);
                            const momValue = seriesData.mom[param.dataIndex];
                            const changeClass = momValue >= 0 ? 'positive' : 'negative';
                            result += param.marker + param.seriesName + ': ' + param.value + 
                                     ' <span class="' + changeClass + '">(' + (momValue >= 0 ? '+' : '') + momValue + '%)</span><br/>';
                        });
                        return result;
                    }
                },
                legend: {
                    bottom: 0,
                    data: data.series.map(item => item.name)
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '15%',
                    top: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'value'
                },
                yAxis: {
                    type: 'category',
                    data: data.categories
                },
                series: data.series.map(item => ({
                    name: item.name,
                    type: 'bar',
                    stack: 'total',
                    label: {
                        show: true,
                        position: 'insideRight'
                    },
                    emphasis: {
                        focus: 'series'
                    },
                    data: item.data
                }))
            };
            chart.setOption(option);
        }

        // Word Cloud / Sunburst Chart
        function initWordChart() {
            const chart = echarts.init(document.getElementById('wordChart'));
            updateWordChart(chart);
        }

        function updateWordChart(chart) {
            chart.clear();
            
            let option;
            
            if (currentWordType === 'wordcloud') {
                option = {
                    tooltip: {
                        show: true
                    },
                    series: [{
                        type: 'wordCloud',
                        gridSize: 2,
                        sizeRange: [12, 50],
                        rotationRange: [-90, 90],
                        shape: 'pentagon',
                        width: '100%',
                        height: '100%',
                        drawOutOfBound: true,
                        textStyle: {
                            fontFamily: 'sans-serif',
                            fontWeight: 'bold',
                            color: function () {
                                return 'rgb(' + [
                                    Math.round(Math.random() * 160),
                                    Math.round(Math.random() * 160),
                                    Math.round(Math.random() * 160)
                                ].join(',') + ')';
                            }
                        },
                        emphasis: {
                            textStyle: {
                                shadowBlur: 10,
                                shadowColor: '#333'
                            }
                        },
                        data: hashtagData.wordcloud
                    }]
                };
            } else {
                // Sunburst chart
                const sunburstData = {
                    name: 'Genders',
                    children: hashtagData.wordcloud.map(item => ({
                        name: item.name,
                        value: item.value
                    }))
                };
                
                option = {
                    series: {
                        type: 'sunburst',
                        data: [sunburstData],
                        radius: [0, '95%'],
                        sort: null,
                        emphasis: {
                            focus: 'ancestor'
                        },
                        levels: [{}, {
                            r0: '15%',
                            r: '80%',
                            itemStyle: {
                                borderWidth: 2
                            },
                            label: {
                                align: 'center'
                            }
                        }, {
                            r0: '80%',
                            r: '90%',
                            label: {
                                position: 'outside',
                                padding: 3,
                                silent: false
                            },
                            itemStyle: {
                                borderWidth: 3
                            }
                        }]
                    }
                };
            }
            
            chart.setOption(option);
        }

        function toggleWordChart(type) {
            currentWordType = type;
            document.querySelectorAll('.section:nth-child(3) .chart-controls .btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const chart = echarts.getInstanceByDom(document.getElementById('wordChart'));
            updateWordChart(chart);
        }

        // Data Table
        function populateDataTable() {
            const tbody = document.getElementById('dataTableBody');
            tbody.innerHTML = '';
            
            hashtagData.table.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${row.gender}</td>
                    <td>${row.authors.toLocaleString()}</td>
                    <td class="${row.authorsMoM >= 0 ? 'positive' : 'negative'}">${row.authorsMoM >= 0 ? '+' : ''}${row.authorsMoM}%</td>
                    <td>${row.posts.toLocaleString()}</td>
                    <td class="${row.postsMoM >= 0 ? 'positive' : 'negative'}">${row.postsMoM >= 0 ? '+' : ''}${row.postsMoM}%</td>
                    <td>${row.interactions.toLocaleString()}</td>
                    <td class="${row.interactionsMoM >= 0 ? 'positive' : 'negative'}">${row.interactionsMoM >= 0 ? '+' : ''}${row.interactionsMoM}%</td>
                    <td>${row.sentiment.toFixed(2)}</td>
                    <td class="${row.sentimentMoM >= 0 ? 'positive' : 'negative'}">${row.sentimentMoM >= 0 ? '+' : ''}${row.sentimentMoM}%</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initCharts();
        });
    </script>
</body>
</html>
