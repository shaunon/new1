<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Duration Analytics</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #4CAF50;
        }
        
        .stat-card h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .stat-change {
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 500;
        }
        
        .positive { background: #e8f5e8; color: #2e7d32; }
        .negative { background: #ffebee; color: #c62828; }
        
        .chart-section {
            margin-bottom: 40px;
        }
        
        .chart-container {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }
        
        .chart-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-left: auto;
        }
        
        .dropdown-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background: #fff;
            cursor: pointer;
        }
        
        .btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: #fff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: #f5f5f5;
        }
        
        .btn.active {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }
        
        .download-btn {
            background: #2196F3;
            color: white;
            border-color: #2196F3;
        }
        
        .download-btn:hover {
            background: #1976D2;
        }
        
        .chart {
            width: 100%;
            height: 400px;
        }
        
        .table-container {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
            position: sticky;
            top: 0;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .qoq-positive {
            color: #2e7d32;
            font-weight: 500;
        }
        
        .qoq-negative {
            color: #c62828;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Statistics Section -->
        <div class="stats-section">
            <div class="stat-card">
                <h3>Total Posts</h3>
                <div class="stat-value" id="totalPosts">125,847</div>
                <span class="stat-change positive" id="postsChange">+12.5% QoQ</span>
            </div>
            <div class="stat-card">
                <h3>Total Videos</h3>
                <div class="stat-value" id="totalVideos">98,234</div>
                <span class="stat-change positive" id="videosChange">+8.7% QoQ</span>
            </div>
            <div class="stat-card">
                <h3>Peak Duration Interval (Posts)</h3>
                <div class="stat-value" id="peakDurationPosts">15~30s</div>
                <span class="stat-change positive" id="peakPostsChange">+1000 posts</span>
            </div>
            <div class="stat-card">
                <h3>Peak Engagement Rate Interval</h3>
                <div class="stat-value" id="peakEngagement">30~60s</div>
                <span class="stat-change positive" id="peakEngagementChange">+15%</span>
            </div>
        </div>

        <!-- Scatter Plot -->
        <div class="chart-section">
            <div class="chart-container">
                <div class="chart-header">
                    <h2 class="chart-title">Posts vs Views by Duration Intervals</h2>
                    <div class="chart-controls">
                        <button class="btn download-btn" onclick="downloadChart('scatterChart')">Download</button>
                    </div>
                </div>
                <div id="scatterChart" class="chart"></div>
            </div>
        </div>

        <!-- Duration Analysis Chart -->
        <div class="chart-section">
            <div class="chart-container">
                <div class="chart-header">
                    <h2 class="chart-title">Video Duration Analysis</h2>
                    <div class="chart-controls">
                        <button class="btn active" onclick="switchDurationMetric('posts')" id="postsBtn">Posts</button>
                        <button class="btn" onclick="switchDurationMetric('views')" id="viewsBtn">Views</button>
                        <button class="btn download-btn" onclick="downloadChart('durationChart')">Download</button>
                    </div>
                </div>
                <div id="durationChart" class="chart"></div>
            </div>
        </div>

        <!-- Time Series Chart -->
        <div class="chart-section">
            <div class="chart-container">
                <div class="chart-header">
                    <h2 class="chart-title">Time Series Analysis</h2>
                    <div class="chart-controls">
                        <div class="dropdown-container">
                            <label for="durationSelect">Duration:</label>
                            <select id="durationSelect" onchange="switchDuration()">
                                <option value="0~15s">0~15s</option>
                                <option value="15~30s">15~30s</option>
                                <option value="30~60s">30~60s</option>
                                <option value="1~3min">1~3min</option>
                                <option value="3~5min">3~5min</option>
                                <option value="5~10min">5~10min</option>
                                <option value="10~20min">10~20min</option>
                                <option value="20~30min">20~30min</option>
                                <option value="30~60min">30~60min</option>
                                <option value=">60min">>60min</option>
                            </select>
                        </div>
                        <button class="btn active" onclick="switchTimeMetric('posts')" id="timePostsBtn">Posts</button>
                        <button class="btn" onclick="switchTimeMetric('views')" id="timeViewsBtn">Views</button>
                        <button class="btn download-btn" onclick="downloadChart('timeChart')">Download</button>
                    </div>
                </div>
                <div id="timeChart" class="chart"></div>
            </div>
        </div>

        <!-- Data Table -->
        <div class="chart-section">
            <div class="chart-container">
                <div class="chart-header">
                    <h2 class="chart-title">Video Duration Data Table</h2>
                    <div class="chart-controls">
                        <button class="btn download-btn" onclick="downloadTable()">Download CSV</button>
                    </div>
                </div>
                <div class="table-container">
                    <table id="dataTable">
                        <thead>
                            <tr>
                                <th>Video Duration</th>
                                <th>Posts</th>
                                <th>Posts QoQ</th>
                                <th>Engagement</th>
                                <th>Engagement QoQ</th>
                                <th>Views</th>
                                <th>Views QoQ</th>
                                <th>Engagement Rate</th>
                                <th>Engagement Rate QoQ</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sample data
        const durationIntervals = ['0~15s', '15~30s', '30~60s', '1~3min', '3~5min', '5~10min', '10~20min', '20~30min', '30~60min', '>60min'];
        
        const sampleData = {
            posts: [15420, 28750, 22340, 18920, 12450, 8760, 5430, 3210, 2180, 1540],
            views: [2.1, 4.2, 3.8, 3.2, 2.1, 1.5, 0.9, 0.6, 0.4, 0.2],
            engagement: [145.2, 287.5, 268.4, 227.0, 149.4, 105.1, 65.2, 38.5, 26.1, 18.5],
            engagementRate: [6.9, 6.8, 12.0, 12.0, 12.0, 12.0, 12.0, 12.0, 12.0, 12.0],
            postsQoQ: [12.5, 15.2, 8.7, -2.3, 5.4, -8.1, -12.4, -15.6, -18.2, -20.1],
            viewsQoQ: [8.3, 11.7, 6.2, -1.8, 3.2, -6.5, -10.2, -13.4, -16.1, -18.5],
            engagementQoQ: [10.2, 13.8, 7.5, -1.5, 4.1, -7.2, -11.3, -14.2, -17.0, -19.2],
            engagementRateQoQ: [5.8, 2.1, -0.8, -3.2, -1.5, -4.8, -6.2, -8.1, -9.5, -11.2]
        };

        // Time series data - expanded with duration-specific data
        const timeSeriesData = {
            dates: ['2024-01', '2024-02', '2024-03', '2024-04', '2024-05', '2024-06'],
            all: {
                posts: [18500, 19200, 20100, 18800, 21300, 22400],
                engagement: [8.5, 9.2, 8.8, 9.5, 10.1, 9.8],
                views: [2.8, 3.1, 2.9, 3.3, 3.6, 3.4],
                postsQoQ: [5.2, 8.1, 12.3, 6.7, 15.2, 18.9],
                engagementQoQ: [2.1, 5.8, 3.2, 8.4, 12.1, 9.7],
                viewsQoQ: [3.5, 7.2, 4.8, 11.2, 15.8, 12.4]
            },
            '0~15s': {
                posts: [2500, 2800, 3100, 2900, 3200, 3400],
                engagement: [6.2, 6.8, 6.5, 7.1, 7.5, 7.2],
                views: [0.35, 0.42, 0.38, 0.45, 0.52, 0.48],
                postsQoQ: [8.2, 12.1, 15.3, 9.7, 18.2, 21.9],
                engagementQoQ: [1.8, 4.2, 2.1, 6.8, 9.5, 7.2],
                viewsQoQ: [4.2, 8.5, 6.1, 13.2, 17.8, 14.4]
            },
            '15~30s': {
                posts: [4800, 5200, 5600, 5100, 5800, 6200],
                engagement: [9.8, 10.5, 10.1, 10.8, 11.2, 10.9],
                views: [0.68, 0.75, 0.71, 0.82, 0.89, 0.85],
                postsQoQ: [12.5, 15.2, 18.3, 12.7, 22.2, 25.9],
                engagementQoQ: [3.1, 7.8, 5.2, 9.4, 13.1, 11.7],
                viewsQoQ: [6.5, 11.2, 8.8, 16.2, 20.8, 17.4]
            }
            // Add more duration intervals as needed
        };

        // Initialize charts
        let scatterChart, durationChart, timeChart;
        let currentDurationMetric = 'posts';
        let currentTimeMetric = 'posts';
        let currentDurationFilter = '0~15s';

        function initCharts() {
            initScatterChart();
            initDurationChart();
            initTimeChart();
            initDataTable();
            
            // Event listeners for duration chart controls
            document.getElementById('postsBtn').addEventListener('click', function() {
                currentDurationMetric = 'posts';
                updateDurationChart();
                updateActiveButton('duration-controls', this);
            });

            document.getElementById('viewsBtn').addEventListener('click', function() {
                currentDurationMetric = 'views';
                updateDurationChart();
                updateActiveButton('duration-controls', this);
            });

            // Event listeners for time series controls
            document.getElementById('timePostsBtn').addEventListener('click', function() {
                currentTimeMetric = 'posts';
                updateTimeChart();
                updateActiveButton('time-controls', this);
            });

            document.getElementById('timeViewsBtn').addEventListener('click', function() {
                currentTimeMetric = 'views';
                updateTimeChart();
                updateActiveButton('time-controls', this);
            });

            document.getElementById('durationSelect').addEventListener('change', function() {
                currentDurationFilter = this.value;
                updateTimeChart();
            });
        }

        function initScatterChart() {
            scatterChart = echarts.init(document.getElementById('scatterChart'));
            
            const scatterData = durationIntervals.map((interval, index) => ({
                name: interval,
                value: [sampleData.posts[index], sampleData.views[index], sampleData.engagement[index]],
                qoq: {
                    posts: sampleData.postsQoQ[index],
                    views: sampleData.viewsQoQ[index],
                    engagement: sampleData.engagementQoQ[index]
                }
            }));

            const option = {
                tooltip: {
                    trigger: 'item',
                    formatter: function(params) {
                        const data = params.data;
                        return `
                            <strong>${data.name}</strong><br/>
                            Posts: ${data.value[0].toLocaleString()}<br/>
                            Views: ${data.value[1]}M<br/>
                            Engagement: ${data.value[2]}K<br/>
                            <hr/>
                            Posts QoQ: ${data.qoq.posts > 0 ? '+' : ''}${data.qoq.posts}%<br/>
                            Views QoQ: ${data.qoq.views > 0 ? '+' : ''}${data.qoq.views}%<br/>
                            Engagement QoQ: ${data.qoq.engagement > 0 ? '+' : ''}${data.qoq.engagement}%
                        `;
                    }
                },
                xAxis: {
                    name: 'Posts',
                    nameLocation: 'middle',
                    nameGap: 30,
                    type: 'value',
                    axisLabel: {
                        formatter: function(value) {
                            return (value / 1000).toFixed(0) + 'K';
                        }
                    }
                },
                yAxis: {
                    name: 'Views (M)',
                    nameLocation: 'middle',
                    nameGap: 40,
                    type: 'value'
                },
                series: [{
                    type: 'scatter',
                    data: scatterData,
                    symbolSize: function(data) {
                        return Math.sqrt(data[2]) * 2;
                    },
                    itemStyle: {
                        color: '#4CAF50',
                        opacity: 0.7
                    },
                    emphasis: {
                        itemStyle: {
                            color: '#2E7D32'
                        }
                    }
                }]
            };

            scatterChart.setOption(option);
        }

        function initDurationChart() {
            durationChart = echarts.init(document.getElementById('durationChart'));
            updateDurationChart();
        }

        function updateDurationChart() {
            const isPostsMode = currentDurationMetric === 'posts';
            const barData = isPostsMode ? sampleData.posts : sampleData.views;
            const lineData = sampleData.engagementRate;
            const barQoQ = isPostsMode ? sampleData.postsQoQ : sampleData.viewsQoQ;
            const lineQoQ = sampleData.engagementRateQoQ;

            const option = {
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross'
                    },
                    formatter: function(params) {
                        let result = `<strong>${params[0].axisValue}</strong><br/>`;
                        params.forEach(param => {
                            const qoq = param.seriesName.includes('Engagement Rate') ? 
                                lineQoQ[param.dataIndex] : barQoQ[param.dataIndex];
                            result += `${param.marker}${param.seriesName}: ${param.value}${param.seriesName.includes('Views') ? 'M' : param.seriesName.includes('Rate') ? '%' : ''}<br/>`;
                            result += `QoQ: ${qoq > 0 ? '+' : ''}${qoq}%<br/>`;
                        });
                        return result;
                    }
                },
                legend: {
                    data: [isPostsMode ? 'Posts' : 'Views (M)', 'Engagement Rate (%)']
                },
                xAxis: {
                    type: 'category',
                    data: durationIntervals,
                    axisLabel: {
                        rotate: 45
                    }
                },
                yAxis: [
                    {
                        type: 'value',
                        name: isPostsMode ? 'Posts' : 'Views (M)',
                        position: 'left',
                        axisLabel: {
                            formatter: function(value) {
                                if (isPostsMode) {
                                    return (value / 1000).toFixed(0) + 'K';
                                }
                                return value.toFixed(1) + 'M';
                            }
                        }
                    },
                    {
                        type: 'value',
                        name: 'Engagement Rate (%)',
                        position: 'right',
                        axisLabel: {
                            formatter: '{value}%'
                        }
                    }
                ],
                series: [
                    {
                        name: isPostsMode ? 'Posts' : 'Views (M)',
                        type: 'bar',
                        data: barData,
                        itemStyle: {
                            color: '#2196F3'
                        }
                    },
                    {
                        name: 'Engagement Rate (%)',
                        type: 'line',
                        yAxisIndex: 1,
                        data: lineData,
                        itemStyle: {
                            color: '#FF9800'
                        },
                        lineStyle: {
                            width: 3
                        }
                    }
                ]
            };

            durationChart.setOption(option);
        }

        function initTimeChart() {
            timeChart = echarts.init(document.getElementById('timeChart'));
            updateTimeChart();
        }

        function updateTimeChart() {
            const currentData = timeSeriesData[currentDurationFilter] || timeSeriesData['0~15s'];
            let primaryData, primaryQoQData, primaryYAxisName, primaryAverage;
            
            // Primary metric (switchable between posts and views)
            switch(currentTimeMetric) {
                case 'posts':
                    primaryData = currentData.posts;
                    primaryQoQData = currentData.postsQoQ;
                    primaryYAxisName = 'Posts';
                    primaryAverage = primaryData.reduce((a, b) => a + b) / primaryData.length;
                    break;
                case 'views':
                    primaryData = currentData.views;
                    primaryQoQData = currentData.viewsQoQ;
                    primaryYAxisName = 'Views (M)';
                    primaryAverage = primaryData.reduce((a, b) => a + b) / primaryData.length;
                    break;
            }
            
            // Engagement rate (always shown)
            const engagementData = currentData.engagement;
            const engagementQoQData = currentData.engagementQoQ;
            const engagementAverage = engagementData.reduce((a, b) => a + b) / engagementData.length;

            const option = {
                tooltip: {
                    trigger: 'axis',
                    formatter: function(params) {
                        const dataIndex = params[0].dataIndex;
                        let result = `<strong>${params[0].axisValue}</strong><br/>`;
                        
                        params.forEach(param => {
                            if (param.seriesName.includes('Engagement Rate')) {
                                const qoq = engagementQoQData[dataIndex];
                                result += `${param.marker}${param.seriesName}: ${param.value}%<br/>`;
                                result += `QoQ: ${qoq > 0 ? '+' : ''}${qoq}%<br/>`;
                            } else {
                                const qoq = primaryQoQData[dataIndex];
                                result += `${param.marker}${param.seriesName}: ${param.value}${currentTimeMetric === 'views' ? 'M' : ''}<br/>`;
                                result += `QoQ: ${qoq > 0 ? '+' : ''}${qoq}%<br/>`;
                            }
                        });
                        
                        return result;
                    }
                },
                legend: {
                    data: [primaryYAxisName, 'Engagement Rate (%)']
                },
                xAxis: {
                    type: 'category',
                    data: timeSeriesData.dates
                },
                yAxis: [
                    {
                        type: 'value',
                        name: primaryYAxisName,
                        position: 'left',
                        axisLabel: {
                            formatter: function(value) {
                                if (currentTimeMetric === 'posts') {
                                    return (value / 1000).toFixed(0) + 'K';
                                } else if (currentTimeMetric === 'views') {
                                    return value.toFixed(1) + 'M';
                                }
                                return value;
                            }
                        }
                    },
                    {
                        type: 'value',
                        name: 'Engagement Rate (%)',
                        position: 'right',
                        axisLabel: {
                            formatter: '{value}%'
                        }
                    }
                ],
                series: [
                    {
                        name: primaryYAxisName,
                        type: 'line',
                        data: primaryData,
                        itemStyle: {
                            color: '#4CAF50'
                        },
                        lineStyle: {
                            width: 3
                        },
                        markLine: {
                            data: [{
                                type: 'average',
                                name: 'Average',
                                lineStyle: {
                                    type: 'dashed',
                                    color: '#4CAF50',
                                    width: 2
                                },
                                label: {
                                    formatter: 'Avg: ' + primaryAverage.toFixed(1) + (currentTimeMetric === 'views' ? 'M' : '')
                                }
                            }]
                        }
                    },
                    {
                        name: 'Engagement Rate (%)',
                        type: 'line',
                        yAxisIndex: 1,
                        data: engagementData,
                        itemStyle: {
                            color: '#FF9800'
                        },
                        lineStyle: {
                            width: 3
                        },
                        markLine: {
                            data: [{
                                type: 'average',
                                name: 'Engagement Average',
                                lineStyle: {
                                    type: 'dashed',
                                    color: '#FF9800',
                                    width: 2
                                },
                                label: {
                                    formatter: 'Avg: ' + engagementAverage.toFixed(1) + '%'
                                }
                            }]
                        }
                    }
                ]
            };

            timeChart.setOption(option);
        }

        function initDataTable() {
            const tableBody = document.getElementById('tableBody');
            
            durationIntervals.forEach((interval, index) => {
                const row = document.createElement('tr');
                
                const formatQoQ = (value) => {
                    const className = value >= 0 ? 'qoq-positive' : 'qoq-negative';
                    return `<span class="${className}">${value > 0 ? '+' : ''}${value}%</span>`;
                };
                
                row.innerHTML = `
                    <td>${interval}</td>
                    <td>${sampleData.posts[index].toLocaleString()}</td>
                    <td>${formatQoQ(sampleData.postsQoQ[index])}</td>
                    <td>${sampleData.engagement[index]}K</td>
                    <td>${formatQoQ(sampleData.engagementQoQ[index])}</td>
                    <td>${sampleData.views[index]}M</td>
                    <td>${formatQoQ(sampleData.viewsQoQ[index])}</td>
                    <td>${sampleData.engagementRate[index]}%</td>
                    <td>${formatQoQ(sampleData.engagementRateQoQ[index])}</td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        function switchDurationMetric(metric) {
            currentDurationMetric = metric;
            
            // Update button states
            document.getElementById('postsBtn').classList.toggle('active', metric === 'posts');
            document.getElementById('viewsBtn').classList.toggle('active', metric === 'views');
            
            updateDurationChart();
        }

        function switchTimeMetric(metric) {
            currentTimeMetric = metric;
            
            // Update button states
            document.getElementById('timePostsBtn').classList.toggle('active', metric === 'posts');
            document.getElementById('timeEngagementBtn').classList.toggle('active', metric === 'engagement');
            document.getElementById('timeViewsBtn').classList.toggle('active', metric === 'views');
            
            updateTimeChart();
        }

        function downloadChart(chartId) {
            let chart;
            switch(chartId) {
                case 'scatterChart':
                    chart = scatterChart;
                    break;
                case 'durationChart':
                    chart = durationChart;
                    break;
                case 'timeChart':
                    chart = timeChart;
                    break;
            }
            
            if (chart) {
                const url = chart.getDataURL({
                    type: 'png',
                    pixelRatio: 2,
                    backgroundColor: '#fff'
                });
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `${chartId}_${new Date().toISOString().split('T')[0]}.png`;
                link.click();
            }
        }

        function downloadTable() {
            const table = document.getElementById('dataTable');
            let csv = '';
            
            // Headers
            const headers = Array.from(table.querySelectorAll('th')).map(th => th.textContent);
            csv += headers.join(',') + '\n';
            
            // Data rows
            const rows = Array.from(table.querySelectorAll('tbody tr'));
            rows.forEach(row => {
                const cells = Array.from(row.querySelectorAll('td')).map(td => {
                    // Remove HTML tags and clean up the text
                    return '"' + td.textContent.replace(/"/g, '""') + '"';
                });
                csv += cells.join(',') + '\n';
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `video_duration_data_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            window.URL.revokeObjectURL(url);
        }

        // Handle window resize
        window.addEventListener('resize', function() {
            if (scatterChart) scatterChart.resize();
            if (durationChart) durationChart.resize();
            if (timeChart) timeChart.resize();
        });

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', initCharts);
    </script>
</body>
</html>
