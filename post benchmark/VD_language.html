<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }
        .chart-container {
            width: 100%;
            height: 500px;
            margin-bottom: 30px;
        }
        .toggle-container {
            margin-bottom: 10px;
            text-align: right;
        }
        .toggle-btn {
            padding: 6px 12px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }
        .toggle-btn.active {
            background-color: #007bff;
            color: white;
            border-color: #0056b3;
        }
        .table-container {
            width: 100%;
            overflow-x: auto;
            margin-bottom: 30px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: right;
        }
        th {
            background-color: #f2f2f2;
            text-align: center;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .language-header {
            text-align: center;
            font-weight: bold;
            background-color: #e6e6e6;
        }
        .metric-name {
            text-align: left;
            font-weight: bold;
        }
        .positive {
            color: green;
        }
        .negative {
            color: red;
        }
    </style>
</head>
<body>
    <div class="toggle-container" id="interactionChartToggle">
        <button class="toggle-btn active" data-type="bar">Bar Chart</button>
        <button class="toggle-btn" data-type="line">Line Chart</button>
    </div>
    <div class="chart-container" id="interactionChart"></div>
    
    <div class="toggle-container" id="interactionRateChartToggle">
        <button class="toggle-btn active" data-type="bar">Bar Chart</button>
        <button class="toggle-btn" data-type="line">Line Chart</button>
    </div>
    <div class="chart-container" id="interactionRateChart"></div>
    
    <div class="toggle-container" id="viewsChartToggle">
        <button class="toggle-btn active" data-type="bar">Bar Chart</button>
        <button class="toggle-btn" data-type="line">Line Chart</button>
    </div>
    <div class="chart-container" id="viewsChart"></div>
    
    <div class="toggle-container" id="postCountChartToggle">
        <button class="toggle-btn active" data-type="bar">Bar Chart</button>
        <button class="toggle-btn" data-type="line">Line Chart</button>
    </div>
    <div class="chart-container" id="postCountChart"></div>
    
    <div class="table-container">
        <table id="metricsTable"></table>
    </div>

    <script>
        // Define video duration categories
        const durationCategories = ['0-15s', '15-30s', '30-60s', '1-3min', '3-5min', '5-10min', '10-20min', '20-30min', '30-60min', '>60min'];
        
        // Define top 10 languages
        const languages = ['English', 'Spanish', 'French', 'German', 'Italian', 'Portuguese', 'Russian', 'Japanese', 'Korean', 'Chinese'];
        
        // Generate sample data for demonstration - organized by languages with duration categories as series
        function generateData() {
            const data = {};
            
            // Initialize data structure: each language contains data for all duration categories
            languages.forEach(language => {
                data[language] = {
                    interaction: [],
                    interactionRate: [],
                    views: [],
                    postCount: [],
                    percentages: {},
                    periodOverPeriod: {}
                };
                
                durationCategories.forEach(duration => {
                    // Generate random values for each metric for this duration in this language
                    data[language].interaction.push(Math.floor(Math.random() * 1000000) + 100000);
                    data[language].interactionRate.push((Math.random() * 10 + 1).toFixed(2));
                    data[language].views.push(Math.floor(Math.random() * 10000000) + 1000000);
                    data[language].postCount.push(Math.floor(Math.random() * 10000) + 1000);
                });
                
                // Calculate percentages for this language
                const totalInteraction = data[language].interaction.reduce((a, b) => a + b, 0);
                const totalViews = data[language].views.reduce((a, b) => a + b, 0);
                const totalPosts = data[language].postCount.reduce((a, b) => a + b, 0);
                
                data[language].percentages = {
                    interaction: data[language].interaction.map(val => ((val / totalInteraction) * 100).toFixed(2)),
                    views: data[language].views.map(val => ((val / totalViews) * 100).toFixed(2)),
                    postCount: data[language].postCount.map(val => ((val / totalPosts) * 100).toFixed(2))
                };
                
                // Generate period-over-period changes (e.g., month-over-month)
                data[language].periodOverPeriod = {
                    interaction: data[language].interaction.map(() => ((Math.random() * 40) - 20).toFixed(2)),
                    interactionRate: data[language].interactionRate.map(() => ((Math.random() * 40) - 20).toFixed(2)),
                    views: data[language].views.map(() => ((Math.random() * 40) - 20).toFixed(2)),
                    postCount: data[language].postCount.map(() => ((Math.random() * 40) - 20).toFixed(2))
                };
            });
            
            return data;
        }
        
        const languageData = generateData();
        
        // Initialize ECharts instances
        const interactionChart = echarts.init(document.getElementById('interactionChart'));
        const interactionRateChart = echarts.init(document.getElementById('interactionRateChart'));
        const viewsChart = echarts.init(document.getElementById('viewsChart'));
        const postCountChart = echarts.init(document.getElementById('postCountChart'));
        
        // Chart configuration
        let chartType = {
            interaction: 'bar',
            interactionRate: 'bar',
            views: 'bar',
            postCount: 'bar'
        };
        
        // Prepare series data for each chart - now organized by duration categories as series
        function prepareSeries(metricName, type) {
            return durationCategories.map((duration, index) => {
                return {
                    name: duration,
                    type: type,
                    stack: type === 'bar' ? 'total' : undefined,
                    emphasis: {
                        focus: 'series'
                    },
                    data: languages.map(language => languageData[language][metricName][durationCategories.indexOf(duration)]),
                    smooth: type === 'line'
                };
            });
        }
        
        // Create chart options
        function createChartOption(title, metricName, yAxisName, type) {
            return {
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: type === 'bar' ? 'shadow' : 'line'
                    }
                },
                legend: {
                    data: durationCategories,
                    type: 'scroll',
                    bottom: 0
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: languages
                },
                yAxis: {
                    type: 'value',
                    name: yAxisName
                },
                series: prepareSeries(metricName, type)
            };
        }
        
        // Render charts
        function renderCharts() {
            interactionChart.setOption(createChartOption('Interaction Volume by Language and Video Duration', 'interaction', 'Interaction Volume', chartType.interaction));
            interactionRateChart.setOption(createChartOption('Interaction Rate by Language and Video Duration', 'interactionRate', 'Interaction Rate (%)', chartType.interactionRate));
            viewsChart.setOption(createChartOption('Views by Language and Video Duration', 'views', 'Views', chartType.views));
            postCountChart.setOption(createChartOption('Post Count by Language and Video Duration', 'postCount', 'Post Count', chartType.postCount));
        }
        
        renderCharts();
        
        // Toggle chart type
        function setupToggleButtons(containerId, chartId) {
            const container = document.getElementById(containerId);
            const buttons = container.querySelectorAll('.toggle-btn');
            
            buttons.forEach(button => {
                button.addEventListener('click', function() {
                    buttons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    const type = this.getAttribute('data-type');
                    chartType[chartId] = type;
                    renderCharts();
                });
            });
        }
        
        setupToggleButtons('interactionChartToggle', 'interaction');
        setupToggleButtons('interactionRateChartToggle', 'interactionRate');
        setupToggleButtons('viewsChartToggle', 'views');
        setupToggleButtons('postCountChartToggle', 'postCount');
        
        // Create data table
        function createDataTable() {
            const table = document.getElementById('metricsTable');
            let html = '';
            
            // Header row with duration categories
            html += '<tr><th>Language</th><th>Metric</th>';
            durationCategories.forEach(duration => {
                html += `<th>${duration}</th>`;
            });
            html += '<th>Total</th></tr>';
            
            // Data rows for each language
            languages.forEach(language => {
                // Language header
                html += `<tr><td colspan="${durationCategories.length + 3}" class="language-header">${language}</td></tr>`;
                
                // Interaction Volume
                html += '<tr><td rowspan="3" class="metric-name">Interaction Volume</td><td>Value</td>';
                const totalInteraction = languageData[language].interaction.reduce((a, b) => a + b, 0);
                languageData[language].interaction.forEach(value => {
                    html += `<td>${value.toLocaleString()}</td>`;
                });
                html += `<td>${totalInteraction.toLocaleString()}</td></tr>`;
                
                // Interaction Volume Percentage
                html += '<tr><td>Percentage (%)</td>';
                languageData[language].percentages.interaction.forEach(value => {
                    html += `<td>${value}%</td>`;
                });
                html += '<td>100%</td></tr>';
                
                // Interaction Volume Period-over-Period
                html += '<tr><td>Period-over-Period (%)</td>';
                languageData[language].periodOverPeriod.interaction.forEach(value => {
                    const cellClass = parseFloat(value) >= 0 ? 'positive' : 'negative';
                    html += `<td class="${cellClass}">${value}%</td>`;
                });
                html += '<td>-</td></tr>';
                
                // Views
                html += '<tr><td rowspan="3" class="metric-name">Views</td><td>Value</td>';
                const totalViews = languageData[language].views.reduce((a, b) => a + b, 0);
                languageData[language].views.forEach(value => {
                    html += `<td>${value.toLocaleString()}</td>`;
                });
                html += `<td>${totalViews.toLocaleString()}</td></tr>`;
                
                // Views Percentage
                html += '<tr><td>Percentage (%)</td>';
                languageData[language].percentages.views.forEach(value => {
                    html += `<td>${value}%</td>`;
                });
                html += '<td>100%</td></tr>';
                
                // Views Period-over-Period
                html += '<tr><td>Period-over-Period (%)</td>';
                languageData[language].periodOverPeriod.views.forEach(value => {
                    const cellClass = parseFloat(value) >= 0 ? 'positive' : 'negative';
                    html += `<td class="${cellClass}">${value}%</td>`;
                });
                html += '<td>-</td></tr>';
                
                // Interaction Rate
                html += '<tr><td rowspan="2" class="metric-name">Interaction Rate (%)</td><td>Value</td>';
                languageData[language].interactionRate.forEach(value => {
                    html += `<td>${value}%</td>`;
                });
                const avgInteractionRate = (languageData[language].interactionRate.reduce((a, b) => parseFloat(a) + parseFloat(b), 0) / languageData[language].interactionRate.length).toFixed(2);
                html += `<td>${avgInteractionRate}%</td></tr>`;
                
                // Interaction Rate Period-over-Period
                html += '<tr><td>Period-over-Period (%)</td>';
                languageData[language].periodOverPeriod.interactionRate.forEach(value => {
                    const cellClass = parseFloat(value) >= 0 ? 'positive' : 'negative';
                    html += `<td class="${cellClass}">${value}%</td>`;
                });
                html += '<td>-</td></tr>';
                
                // Post Count
                html += '<tr><td rowspan="3" class="metric-name">Post Count</td><td>Value</td>';
                const totalPosts = languageData[language].postCount.reduce((a, b) => a + b, 0);
                languageData[language].postCount.forEach(value => {
                    html += `<td>${value.toLocaleString()}</td>`;
                });
                html += `<td>${totalPosts.toLocaleString()}</td></tr>`;
                
                // Post Count Percentage
                html += '<tr><td>Percentage (%)</td>';
                languageData[language].percentages.postCount.forEach(value => {
                    html += `<td>${value}%</td>`;
                });
                html += '<td>100%</td></tr>';
                
                // Post Count Period-over-Period
                html += '<tr><td>Period-over-Period (%)</td>';
                languageData[language].periodOverPeriod.postCount.forEach(value => {
                    const cellClass = parseFloat(value) >= 0 ? 'positive' : 'negative';
                    html += `<td class="${cellClass}">${value}%</td>`;
                });
                html += '<td>-</td></tr>';
            });
            
            table.innerHTML = html;
        }
        
        createDataTable();
        
        // Handle window resize
        window.addEventListener('resize', function() {
            interactionChart.resize();
            interactionRateChart.resize();
            viewsChart.resize();
            postCountChart.resize();
        });
    </script>
</body>
</html>