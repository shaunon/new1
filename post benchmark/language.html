<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"></script>
    <script>
        // Register themeRiver chart
        if (typeof echarts !== 'undefined') {
            echarts.registerChart = echarts.registerChart || function() {};
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .section {
            margin-bottom: 40px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        
        .section-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        
        .chart-container {
            width: 100%;
            height: 500px;
            margin-bottom: 20px;
        }
        
        .chart-controls {
            margin-bottom: 20px;
            text-align: center;
        }
        
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 0 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .btn.active {
            background: #e74c3c;
        }
        
        .stacked-charts {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stacked-chart {
            height: 400px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .data-table th,
        .data-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        .data-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .data-table tr:hover {
            background-color: #e8f4f8;
        }
        
        .positive {
            color: #27ae60;
            font-weight: 600;
        }
        
        .negative {
            color: #e74c3c;
            font-weight: 600;
        }
        
        @media (max-width: 768px) {
            .stacked-charts {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                height: 400px;
            }
            
            .stacked-chart {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- River Chart / Area Chart Section -->
        <div class="section">
            <h2 class="section-title">Languages - Post Count & Period-over-Period Comparison</h2>
            <div class="chart-controls">
                <button class="btn active" onclick="toggleRiverChart('themeriver')">Theme River</button>
                <button class="btn" onclick="toggleRiverChart('area')">Area Chart</button>
            </div>
            <div id="riverChart" class="chart-container"></div>
        </div>

        <!-- Stacked Bar Charts Section -->
        <div class="section">
            <h2 class="section-title">Distribution Analysis</h2>
            <div class="stacked-charts">
                <div id="countryChart" class="stacked-chart"></div>
                <div id="languageChart" class="stacked-chart"></div>
                <div id="sentimentChart" class="stacked-chart"></div>
            </div>
        </div>

        <!-- Word Cloud / Sunburst Chart Section -->
        <div class="section">
            <h2 class="section-title">Top 100 Languages Visualization</h2>
            <div class="chart-controls">
                <button class="btn active" onclick="toggleWordChart('wordcloud')">Word Cloud</button>
                <button class="btn" onclick="toggleWordChart('sunburst')">Sunburst Chart</button>
            </div>
            <div id="wordChart" class="chart-container"></div>
        </div>

        <!-- Data Table Section -->
        <div class="section">
            <h2 class="section-title">Language Performance Metrics</h2>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Language</th>
                        <th>Authors</th>
                        <th>Authors (MoM %)</th>
                        <th>Posts</th>
                        <th>Posts (MoM %)</th>
                        <th>Interactions</th>
                        <th>Interactions (MoM %)</th>
                        <th>Net Sentiment</th>
                        <th>Sentiment (MoM %)</th>
                    </tr>
                </thead>
                <tbody id="dataTableBody">
                    <!-- Data will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Sample data - replace with actual data
        const hashtagData = {
            themeRiver: [
                ['2024-01-01', 120, 'English', 14.3],
                ['2024-01-02', 132, 'English', 10.0],
                ['2024-01-03', 101, 'English', -23.5],
                ['2024-01-04', 134, 'English', 32.7],
                ['2024-01-05', 90, 'English', -32.8],
                ['2024-01-06', 230, 'English', 155.6],
                ['2024-01-07', 210, 'English', -8.7],
                ['2024-01-01', 220, 'Spanish', -2.1],
                ['2024-01-02', 182, 'Spanish', -17.3],
                ['2024-01-03', 191, 'Spanish', 4.9],
                ['2024-01-04', 234, 'Spanish', 22.5],
                ['2024-01-05', 290, 'Spanish', 23.9],
                ['2024-01-06', 330, 'Spanish', 13.8],
                ['2024-01-07', 310, 'Spanish', -6.1],
                ['2024-01-01', 150, 'French', 6.2],
                ['2024-01-02', 232, 'French', 54.7],
                ['2024-01-03', 201, 'French', -13.4],
                ['2024-01-04', 154, 'French', -23.4],
                ['2024-01-05', 190, 'French', 23.4],
                ['2024-01-06', 330, 'French', 73.7],
                ['2024-01-07', 410, 'French', 24.2],
                ['2024-01-01', 320, 'German', 8.1],
                ['2024-01-02', 332, 'German', 3.8],
                ['2024-01-03', 301, 'German', -9.3],
                ['2024-01-04', 334, 'German', 11.0],
                ['2024-01-05', 390, 'German', 16.8],
                ['2024-01-06', 330, 'German', -15.4],
                ['2024-01-07', 320, 'German', -3.0],
                ['2024-01-01', 820, 'Others', 12.5],
                ['2024-01-02', 932, 'Others', 13.7],
                ['2024-01-03', 901, 'Others', -3.3],
                ['2024-01-04', 934, 'Others', 3.7],
                ['2024-01-05', 1290, 'Others', 38.1],
                ['2024-01-06', 1330, 'Others', 3.1],
                ['2024-01-07', 1320, 'Others', -0.8]
            ],
            platforms: {
                categories: ['English', 'Spanish', 'French', 'German', 'Chinese', 'Others'],
                series: [
                    { name: 'TikTok', data: [320, 302, 301, 334, 390, 330], mom: [12.5, -3.2, 8.7, 15.3, 22.1, 5.8] },
                    { name: 'Instagram', data: [120, 132, 101, 134, 90, 230], mom: [8.3, 15.7, -12.4, 9.2, -18.5, 25.6] },
                    { name: 'YouTube', data: [220, 182, 191, 234, 290, 330], mom: [5.6, -2.4, 18.9, 7.4, 33.2, 14.7] },
                    { name: 'Twitter', data: [150, 232, 201, 154, 190, 330], mom: [12.1, 22.3, -1.2, 0.5, 8.9, 19.3] },
                    { name: 'Facebook', data: [862, 1018, 964, 1026, 1103, 1256], mom: [3.8, 9.1, 4.2, 6.7, 11.2, 8.5] }
                ]
            },
            countries: {
                categories: ['English', 'Spanish', 'French', 'German', 'Chinese', 'Others'],
                series: [
                    { name: 'USA', data: [420, 402, 401, 434, 490, 530], mom: [15.2, 8.9, 12.3, 18.7, 25.4, 11.6] },
                    { name: 'UK', data: [220, 232, 201, 234, 290, 330], mom: [7.8, 14.2, -5.6, 9.8, 19.3, 16.7] },
                    { name: 'Canada', data: [150, 182, 191, 154, 190, 230], mom: [3.4, 12.7, 8.1, -2.3, 15.8, 22.1] },
                    { name: 'Australia', data: [120, 132, 101, 134, 90, 180], mom: [9.1, 6.5, -8.9, 11.2, -12.4, 28.3] },
                    { name: 'Others', data: [762, 918, 864, 926, 1003, 1156], mom: [5.7, 13.4, 7.2, 9.8, 14.6, 10.2] }
                ]
            },
            languages: {
                categories: ['English', 'Spanish', 'French', 'German', 'Chinese', 'Others'],
                series: [
                    { name: 'English', data: [520, 502, 501, 534, 590, 630], mom: [12.8, 6.7, 9.4, 16.2, 21.3, 13.5] },
                    { name: 'Spanish', data: [220, 232, 201, 234, 290, 330], mom: [8.9, 15.6, -3.2, 12.1, 24.7, 18.9] },
                    { name: 'French', data: [150, 182, 191, 154, 190, 230], mom: [4.3, 11.8, 7.6, -1.8, 14.2, 25.4] },
                    { name: 'German', data: [120, 132, 101, 134, 90, 180], mom: [6.7, 8.2, -7.4, 9.8, -15.6, 31.2] },
                    { name: 'Others', data: [662, 818, 764, 826, 903, 1056], mom: [7.1, 12.9, 5.8, 8.4, 16.8, 9.7] }
                ]
            },
            sentiments: {
                categories: ['English', 'Spanish', 'French', 'German', 'Chinese', 'Others'],
                series: [
                    { name: 'Positive', data: [620, 602, 601, 634, 690, 730], mom: [14.3, 8.1, 11.7, 19.2, 23.8, 15.6] },
                    { name: 'Neutral', data: [320, 332, 301, 334, 390, 430], mom: [6.2, 9.8, 4.5, 12.3, 18.7, 11.4] },
                    { name: 'Negative', data: [120, 132, 101, 134, 90, 180], mom: [-2.1, 5.4, -8.7, 7.2, -16.3, 24.8] }
                ]
            },
            wordcloud: [
                { name: 'English', value: 1500 },
                { name: 'Spanish', value: 1200 },
                { name: 'French', value: 1000 },
                { name: 'German', value: 900 },
                { name: 'Chinese', value: 800 },
                { name: 'Japanese', value: 700 },
                { name: 'Korean', value: 650 },
                { name: 'Portuguese', value: 600 },
                { name: 'Italian', value: 550 },
                { name: 'Russian', value: 500 }
                // Add more languages up to 100
            ],
            table: [
                { language: 'English', authors: 15420, authorsMoM: 12.5, posts: 45230, postsMoM: 8.3, interactions: 2340000, interactionsMoM: 15.7, sentiment: 0.75, sentimentMoM: 2.1 },
                { language: 'Spanish', authors: 12340, authorsMoM: -3.2, posts: 38920, postsMoM: 5.6, interactions: 1890000, interactionsMoM: -2.4, sentiment: 0.82, sentimentMoM: 1.8 },
                { language: 'French', authors: 9870, authorsMoM: 18.9, posts: 32450, postsMoM: 12.1, interactions: 1560000, interactionsMoM: 22.3, sentiment: 0.68, sentimentMoM: -1.2 },
                { language: 'German', authors: 8760, authorsMoM: 7.4, posts: 28930, postsMoM: 3.8, interactions: 1230000, interactionsMoM: 9.1, sentiment: 0.71, sentimentMoM: 0.5 },
                { language: 'Chinese', authors: 7650, authorsMoM: -1.8, posts: 25670, postsMoM: -0.9, interactions: 1120000, interactionsMoM: 4.2, sentiment: 0.79, sentimentMoM: 3.2 }
            ]
        };

        let currentRiverType = 'themeriver';
        let currentWordType = 'wordcloud';

        // Initialize charts
        function initCharts() {
            initRiverChart();
            initStackedCharts();
            initWordChart();
            populateDataTable();
        }

        // River Chart / Area Chart
        function initRiverChart() {
            const chart = echarts.init(document.getElementById('riverChart'));
            updateRiverChart(chart);
        }

        function updateRiverChart(chart) {
            // Clear the chart first to prevent overlapping
            chart.clear();
            
            let option;
            
            if (currentRiverType === 'themeriver') {
                option = {
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'line'
                        },
                        formatter: function(params) {
                            let result = params[0].data[0] + '<br/>';
                            params.forEach(param => {
                                const momValue = param.data[3];
                                const momClass = momValue >= 0 ? 'positive' : 'negative';
                                const momSign = momValue >= 0 ? '+' : '';
                                result += param.data[2] + ': ' + param.data[1] + 
                                         ' <span style="color: ' + (momValue >= 0 ? '#52c41a' : '#ff4d4f') + '">(' + 
                                         momSign + momValue + '%)</span><br/>';
                            });
                            return result;
                        }
                    },
                    legend: {
                        data: ['English', 'Spanish', 'French', 'German', 'Others']
                    },
                    singleAxis: {
                        type: 'time',
                        top: 50,
                        bottom: 50,
                        axisPointer: {
                            animation: true,
                            label: {
                                show: true
                            }
                        }
                    },
                    series: [{
                        type: 'themeRiver',
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 20,
                                shadowColor: 'rgba(0, 0, 0, 0.8)'
                            }
                        },
                        data: hashtagData.themeRiver
                    }]
                };
            } else {
                // Area chart fallback
                const processedData = hashtagData.themeRiver.reduce((acc, item) => {
                    const [date, value, name, mom] = item;
                    if (!acc[name]) {
                        acc[name] = [];
                    }
                    acc[name].push([date, value, mom]);
                    return acc;
                }, {});

                const series = Object.keys(processedData).map(name => ({
                    name: name,
                    type: 'line',
                    stack: 'Total',
                    areaStyle: {},
                    emphasis: {
                        focus: 'series'
                    },
                    data: processedData[name]
                }));

                option = {
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'cross',
                            label: {
                                backgroundColor: '#6a7985'
                            }
                        },
                        formatter: function(params) {
                            let result = params[0].axisValue + '<br/>';
                            params.forEach(param => {
                                const momValue = param.data[2];
                                const momSign = momValue >= 0 ? '+' : '';
                                result += param.seriesName + ': ' + param.data[1] + 
                                         ' <span style="color: ' + (momValue >= 0 ? '#52c41a' : '#ff4d4f') + '">(' + 
                                         momSign + momValue + '%)</span><br/>';
                            });
                            return result;
                        }
                    },
                    legend: {
                        data: Object.keys(processedData)
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true
                    },
                    xAxis: {
                        type: 'time',
                        boundaryGap: false
                    },
                    yAxis: {
                        type: 'value'
                    },
                    series: series
                };
            }
            
            chart.setOption(option);
        }

        function toggleRiverChart(type) {
            currentRiverType = type;
            document.querySelectorAll('.section:first-child .chart-controls .btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const chart = echarts.getInstanceByDom(document.getElementById('riverChart'));
            updateRiverChart(chart);
        }

        // Stacked Bar Charts
        function initStackedCharts() {
            initStackedChart('countryChart', 'Country Distribution', hashtagData.countries);
            initStackedChart('languageChart', 'Platform Distribution', hashtagData.platforms);
            initStackedChart('sentimentChart', 'Sentiment Distribution', hashtagData.sentiments);
        }

        function initStackedChart(containerId, title, data) {
            const chart = echarts.init(document.getElementById(containerId));
            const option = {
                title: {
                    text: title,
                    left: 'center',
                    textStyle: {
                        fontSize: 16,
                        fontWeight: 'bold'
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    },
                    formatter: function(params) {
                        let result = params[0].name + '<br/>';
                        params.forEach((param, index) => {
                            const seriesData = data.series.find(s => s.name === param.seriesName);
                            const momValue = seriesData.mom[param.dataIndex];
                            const changeClass = momValue >= 0 ? 'positive' : 'negative';
                            result += param.marker + param.seriesName + ': ' + param.value + 
                                     ' <span class="' + changeClass + '">(' + (momValue >= 0 ? '+' : '') + momValue + '%)</span><br/>';
                        });
                        return result;
                    }
                },
                legend: {
                    bottom: 0,
                    data: data.series.map(item => item.name)
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '15%',
                    top: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'value'
                },
                yAxis: {
                    type: 'category',
                    data: data.categories
                },
                series: data.series.map(item => ({
                    name: item.name,
                    type: 'bar',
                    stack: 'total',
                    label: {
                        show: true,
                        position: 'insideRight'
                    },
                    emphasis: {
                        focus: 'series'
                    },
                    data: item.data
                }))
            };
            chart.setOption(option);
        }

        // Word Cloud / Sunburst Chart
        function initWordChart() {
            const chart = echarts.init(document.getElementById('wordChart'));
            updateWordChart(chart);
        }

        function updateWordChart(chart) {
            let option;
            
            if (currentWordType === 'wordcloud') {
                option = {
                    tooltip: {
                        show: true
                    },
                    series: [{
                        type: 'wordCloud',
                        gridSize: 2,
                        sizeRange: [12, 50],
                        rotationRange: [-90, 90],
                        shape: 'pentagon',
                        width: '100%',
                        height: '100%',
                        drawOutOfBound: true,
                        textStyle: {
                            fontFamily: 'sans-serif',
                            fontWeight: 'bold',
                            color: function () {
                                return 'rgb(' + [
                                    Math.round(Math.random() * 160),
                                    Math.round(Math.random() * 160),
                                    Math.round(Math.random() * 160)
                                ].join(',') + ')';
                            }
                        },
                        emphasis: {
                            textStyle: {
                                shadowBlur: 10,
                                shadowColor: '#333'
                            }
                        },
                        data: hashtagData.wordcloud
                    }]
                };
            } else {
                // Sunburst chart
                const sunburstData = [
                    {
                        name: 'Languages',
                        children: hashtagData.wordcloud.map(item => ({
                            name: item.name,
                            value: item.value
                        }))
                    }
                ];
                
                option = {
                    tooltip: {
                        trigger: 'item',
                        formatter: '{b}: {c}'
                    },
                    series: [{
                        type: 'sunburst',
                        data: sunburstData,
                        radius: [0, '90%'],
                        itemStyle: {
                            borderRadius: 7,
                            borderWidth: 2
                        },
                        label: {
                            show: false
                        }
                    }]
                };
            }
            
            chart.setOption(option);
        }

        function toggleWordChart(type) {
            currentWordType = type;
            document.querySelectorAll('.section:nth-child(3) .chart-controls .btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const chart = echarts.getInstanceByDom(document.getElementById('wordChart'));
            updateWordChart(chart);
        }

        // Data Table
        function populateDataTable() {
            const tbody = document.getElementById('dataTableBody');
            tbody.innerHTML = '';
            
            hashtagData.table.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${row.language}</td>
                    <td>${row.authors.toLocaleString()}</td>
                    <td class="${row.authorsMoM >= 0 ? 'positive' : 'negative'}">${row.authorsMoM >= 0 ? '+' : ''}${row.authorsMoM}%</td>
                    <td>${row.posts.toLocaleString()}</td>
                    <td class="${row.postsMoM >= 0 ? 'positive' : 'negative'}">${row.postsMoM >= 0 ? '+' : ''}${row.postsMoM}%</td>
                    <td>${row.interactions.toLocaleString()}</td>
                    <td class="${row.interactionsMoM >= 0 ? 'positive' : 'negative'}">${row.interactionsMoM >= 0 ? '+' : ''}${row.interactionsMoM}%</td>
                    <td>${row.sentiment.toFixed(2)}</td>
                    <td class="${row.sentimentMoM >= 0 ? 'positive' : 'negative'}">${row.sentimentMoM >= 0 ? '+' : ''}${row.sentimentMoM}%</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Initialize everything when page loads
        window.addEventListener('load', initCharts);
    </script>
</body>
</html>
